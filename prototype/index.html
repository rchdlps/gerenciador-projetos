<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão - Integração Planejamento e Orçamento</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Plus Jakarta Sans', 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .breadcrumb {
            max-width: 1800px;
            margin: 0 auto 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .breadcrumb a {
            color: #367962;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }

        .breadcrumb a:hover {
            color: #22524C;
        }

        .breadcrumb-separator {
            color: #adb5bd;
        }

        .breadcrumb-current {
            color: #495057;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #367962 0%, #22524C 100%);
            color: white;
            padding: 0;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 50%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="80" cy="20" r="30" fill="rgba(245,199,69,0.1)"/><circle cx="90" cy="60" r="20" fill="rgba(81,166,90,0.1)"/></svg>');
            background-size: 400px;
            background-position: right center;
            opacity: 0.3;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #F5C745 0%, #F9DE4B 33%, #51A65A 66%, #367962 100%);
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 25px 40px 20px 40px;
            border-bottom: 1px solid rgba(255,255,255,0.15);
            position: relative;
            z-index: 1;
        }

        .header-logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-logo {
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
        }

        .header-logo svg {
            width: 100%;
            height: 100%;
        }

        .header-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .header-title-section {
            flex: 1;
        }

        .header h1 {
            font-size: 26px;
            font-weight: 800;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .header-subtitle {
            font-size: 14px;
            opacity: 0.95;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .project-config-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 2px solid #e9ecef;
            border-radius: 12px;
            margin-bottom: 25px;
            overflow: hidden;
        }

        .project-config-header {
            background: linear-gradient(135deg, #367962 0%, #22524C 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .project-config-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 16px;
        }

        .project-config-icon {
            font-size: 20px;
        }

        .project-config-body {
            padding: 20px 25px;
        }

        .project-name-edit-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .project-name-edit-label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .project-name-edit-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        #projectNameInput {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            color: #212529;
            transition: all 0.3s;
            font-family: inherit;
            background: white;
        }

        #projectNameInput:focus {
            outline: none;
            border-color: #367962;
            box-shadow: 0 0 0 3px rgba(54, 121, 98, 0.1);
        }

        #projectNameInput::placeholder {
            color: #adb5bd;
        }

        .project-name-edit-hint {
            font-size: 12px;
            color: #6c757d;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Stakeholders Section */
        .stakeholders-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .stakeholders-header {
            background: linear-gradient(135deg, #367962 0%, #22524C 100%);
            color: white;
            padding: 18px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stakeholders-header-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 16px;
        }

        .stakeholders-icon {
            font-size: 22px;
        }

        .stakeholders-body {
            padding: 20px 25px;
        }

        .stakeholders-hint {
            background: #fff3cd;
            border-left: 4px solid #F5C745;
            padding: 12px 15px;
            border-radius: 6px;
            font-size: 13px;
            color: #664d03;
            margin-bottom: 20px;
        }

        .stakeholders-list {
            display: grid;
            gap: 15px;
        }

        .stakeholder-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 18px 20px;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 20px;
            align-items: center;
            transition: all 0.3s;
            margin-bottom: 12px;
        }

        .stakeholder-item:hover {
            border-color: #367962;
            box-shadow: 0 4px 12px rgba(54, 121, 98, 0.1);
        }

        /* Estilos compactos para stakeholders dentro da área de conhecimento */
        .knowledge-area-content .stakeholder-item {
            padding: 12px 15px;
            grid-template-columns: 40px 1fr auto auto;
            gap: 12px;
        }

        .knowledge-area-content .stakeholder-avatar {
            width: 40px;
            height: 40px;
            font-size: 16px;
        }

        .knowledge-area-content .stakeholder-info {
            display: grid;
            grid-template-columns: 2fr 2fr;
            gap: 10px;
        }

        .knowledge-area-content .stakeholder-name-input,
        .knowledge-area-content .stakeholder-role-input {
            padding: 6px 10px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .knowledge-area-content .stakeholder-name-input:focus,
        .knowledge-area-content .stakeholder-role-input:focus {
            outline: none;
            border-color: #367962;
            box-shadow: 0 0 0 2px rgba(54, 121, 98, 0.1);
        }

        .knowledge-area-content .stakeholder-level-select {
            padding: 6px 10px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .knowledge-area-content .stakeholder-level-select:focus {
            outline: none;
            border-color: #367962;
            box-shadow: 0 0 0 2px rgba(54, 121, 98, 0.1);
        }

        .knowledge-area-content .stakeholder-delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .knowledge-area-content .stakeholder-delete-btn:hover {
            background: #c82333;
        }

        .stakeholder-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #367962 0%, #22524C 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .stakeholder-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .stakeholder-fields {
            display: grid;
            grid-template-columns: 2fr 2fr 1.5fr;
            gap: 12px;
            align-items: start;
        }

        .stakeholder-field {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .stakeholder-field-label {
            font-size: 11px;
            font-weight: 600;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stakeholder-field input,
        .stakeholder-field select {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .stakeholder-field input:focus,
        .stakeholder-field select:focus {
            outline: none;
            border-color: #367962;
            box-shadow: 0 0 0 3px rgba(54, 121, 98, 0.1);
        }

        .stakeholder-actions {
            display: flex;
            gap: 8px;
        }

        .stakeholder-delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stakeholder-delete-btn:hover {
            background: #c82333;
            transform: scale(1.05);
        }

        .stakeholder-level-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            margin-top: 4px;
        }

        .level-patrocinador {
            background: #d4edda;
            color: #155724;
        }

        .level-gerente {
            background: #cfe2ff;
            color: #084298;
        }

        .level-equipe {
            background: #fff3cd;
            color: #664d03;
        }

        .level-interessado {
            background: #f8d7da;
            color: #842029;
        }

        .empty-stakeholders {
            text-align: center;
            padding: 40px 20px;
            color: #adb5bd;
        }

        .empty-stakeholders-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .empty-stakeholders-text {
            font-size: 15px;
            font-weight: 600;
        }

        /* Knowledge Areas Section */
        .knowledge-areas-intro {
            background: #e7f5ff;
            border-left: 4px solid #367962;
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 13px;
            color: #22524C;
            margin-bottom: 25px;
        }

        .knowledge-areas-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(480px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .knowledge-area-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s;
        }

        .knowledge-area-card:hover {
            border-color: #367962;
            box-shadow: 0 8px 24px rgba(54, 121, 98, 0.12);
        }

        .knowledge-area-header {
            background: linear-gradient(135deg, #367962 0%, #22524C 100%);
            color: white;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .knowledge-area-header::after {
            content: 'Clique para abrir';
            position: absolute;
            right: 60px;
            font-size: 11px;
            opacity: 0;
            transition: all 0.3s;
            background: rgba(245, 199, 69, 0.9);
            color: #22524C;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }

        .knowledge-area-header:hover {
            background: linear-gradient(135deg, #22524C 0%, #367962 100%);
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(54, 121, 98, 0.3);
        }

        .knowledge-area-header:hover::after {
            opacity: 1;
        }

        .knowledge-area-header:hover .knowledge-area-toggle {
            transform: scale(1.2);
        }

        .knowledge-area-icon {
            font-size: 28px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .knowledge-area-title-section {
            flex: 1;
        }

        .knowledge-area-name {
            font-size: 17px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .knowledge-area-desc {
            font-size: 12px;
            opacity: 0.9;
        }

        .knowledge-area-toggle {
            font-size: 20px;
            transition: transform 0.3s;
            background: rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .knowledge-area-toggle.rotated {
            transform: rotate(180deg);
        }

        .knowledge-area-content {
            display: none;
            padding: 20px;
        }

        .knowledge-area-content.active {
            display: block;
        }

        .knowledge-area-field {
            margin-bottom: 20px;
        }

        .knowledge-area-label {
            font-weight: 600;
            color: #495057;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            display: block;
        }

        .knowledge-area-textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s;
        }

        .knowledge-area-textarea:focus {
            outline: none;
            border-color: #367962;
            box-shadow: 0 0 0 3px rgba(54, 121, 98, 0.1);
        }

        .knowledge-area-attachments {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #f1f3f5;
        }

        .knowledge-area-attachments-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .knowledge-area-attachments-title {
            font-weight: 600;
            color: #495057;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .knowledge-area-upload-btn {
            background: #367962;
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .knowledge-area-upload-btn:hover {
            background: #22524C;
            transform: translateY(-2px);
        }

        .knowledge-area-attachments-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .knowledge-area-attachment-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .knowledge-area-attachment-item:hover {
            background: #e9ecef;
        }

        .knowledge-area-attachment-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .knowledge-area-attachment-icon {
            font-size: 20px;
        }

        .knowledge-area-attachment-details {
            flex: 1;
        }

        .knowledge-area-attachment-name {
            font-weight: 600;
            font-size: 13px;
            color: #212529;
            word-break: break-all;
        }

        .knowledge-area-attachment-meta {
            font-size: 11px;
            color: #6c757d;
        }

        .knowledge-area-attachment-actions {
            display: flex;
            gap: 6px;
        }

        .knowledge-area-attachment-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .knowledge-area-download-btn {
            background: #367962;
            color: white;
        }

        .knowledge-area-download-btn:hover {
            background: #22524C;
        }

        .knowledge-area-delete-btn {
            background: #dc3545;
            color: white;
        }

        .knowledge-area-delete-btn:hover {
            background: #c82333;
        }

        /* Scrumban Board */
        .scrumban-section {
            margin-bottom: 30px;
        }

        .scrumban-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
        }

        .scrumban-filters {
            display: flex;
            gap: 15px;
            align-items: center;
            flex: 1;
        }

        .scrumban-filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .scrumban-filter-label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .scrumban-filter-select {
            padding: 8px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }

        .scrumban-filter-select:focus {
            outline: none;
            border-color: #367962;
            box-shadow: 0 0 0 3px rgba(54, 121, 98, 0.1);
        }

        .scrumban-search {
            flex: 1;
            max-width: 300px;
            position: relative;
        }

        .scrumban-search input {
            width: 100%;
            padding: 8px 15px 8px 40px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .scrumban-search input:focus {
            outline: none;
            border-color: #367962;
            box-shadow: 0 0 0 3px rgba(54, 121, 98, 0.1);
        }

        .scrumban-search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            font-size: 16px;
        }

        .scrumban-expand-btn {
            background: #367962;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .scrumban-expand-btn:hover {
            background: #22524C;
            transform: translateY(-2px);
        }

        .scrumban-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .scrumban-board.expanded {
            max-height: none;
        }

        .scrumban-column {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }

        .scrumban-column-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 3px solid;
        }

        .scrumban-column.nao-iniciada .scrumban-column-header {
            border-bottom-color: #adb5bd;
        }

        .scrumban-column.em-andamento .scrumban-column-header {
            border-bottom-color: #0d6efd;
        }

        .scrumban-column.em-revisao .scrumban-column-header {
            border-bottom-color: #ffc107;
        }

        .scrumban-column.concluida .scrumban-column-header {
            border-bottom-color: #198754;
        }

        .scrumban-column-title {
            font-weight: 700;
            font-size: 15px;
            color: #212529;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .scrumban-column-count {
            background: white;
            color: #495057;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 700;
        }

        .scrumban-cards {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
            overflow-y: auto;
            max-height: 600px;
            padding-right: 5px;
        }

        .scrumban-cards::-webkit-scrollbar {
            width: 6px;
        }

        .scrumban-cards::-webkit-scrollbar-track {
            background: #e9ecef;
            border-radius: 3px;
        }

        .scrumban-cards::-webkit-scrollbar-thumb {
            background: #adb5bd;
            border-radius: 3px;
        }

        .scrumban-cards::-webkit-scrollbar-thumb:hover {
            background: #6c757d;
        }

        .scrumban-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            cursor: grab;
            transition: all 0.3s;
        }

        .scrumban-card:hover {
            border-color: #367962;
            box-shadow: 0 4px 12px rgba(54, 121, 98, 0.15);
            transform: translateY(-2px);
        }

        .scrumban-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .scrumban-card-title {
            font-weight: 600;
            font-size: 14px;
            color: #212529;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .scrumban-card-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            font-size: 12px;
            color: #6c757d;
            margin-top: 8px;
        }

        .scrumban-card-phase {
            background: #e7f5ff;
            color: #0d6efd;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .scrumban-card-responsible {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .scrumban-empty {
            text-align: center;
            padding: 30px 15px;
            color: #adb5bd;
            font-size: 13px;
        }

        /* Calendário Melhorado */
        .calendar-widget {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            position: relative;
        }

        .calendar-expand-btn {
            position: absolute;
            top: 20px;
            right: 60px;
            background: #367962;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .calendar-expand-btn:hover {
            background: #22524C;
            transform: scale(1.05);
        }

        .calendar-day.has-tasks {
            background: rgba(54, 121, 98, 0.1);
            border: 2px solid #367962;
            font-weight: 600;
        }

        .calendar-day.has-tasks:hover {
            background: rgba(54, 121, 98, 0.2);
        }

        .calendar-day-indicator {
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 2px;
        }

        .calendar-day-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #367962;
        }

        /* Modal de Calendário Expandido */
        .calendar-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(4px);
        }

        .calendar-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-modal-content {
            background: white;
            border-radius: 16px;
            width: 95%;
            max-width: 1200px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .calendar-modal-header {
            background: linear-gradient(135deg, #367962 0%, #22524C 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calendar-modal-body {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            padding: 25px;
            overflow-y: auto;
            max-height: calc(90vh - 80px);
        }

        .calendar-modal-calendar {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
        }

        .calendar-modal-tasks {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
        }

        .calendar-modal-tasks-title {
            font-weight: 700;
            color: #367962;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .calendar-modal-task-item {
            background: #f8f9fa;
            border-left: 4px solid #367962;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .calendar-modal-task-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 6px;
        }

        .calendar-modal-task-meta {
            font-size: 12px;
            color: #6c757d;
        }

        /* Modal de Área de Conhecimento */
        .knowledge-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(4px);
        }

        .knowledge-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .knowledge-modal-content {
            background: white;
            border-radius: 16px;
            width: 95%;
            max-width: 1400px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .knowledge-modal-header {
            background: linear-gradient(135deg, #367962 0%, #22524C 100%);
            color: white;
            padding: 25px 35px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid #F5C745;
        }

        .knowledge-modal-title-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .knowledge-modal-icon {
            font-size: 42px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }

        .knowledge-modal-title-text h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .knowledge-modal-title-text p {
            font-size: 14px;
            opacity: 0.9;
        }

        .knowledge-modal-body {
            padding: 35px;
            overflow-y: auto;
            max-height: calc(90vh - 120px);
        }

        .knowledge-section {
            margin-bottom: 35px;
        }

        .knowledge-section-title {
            font-size: 20px;
            font-weight: 700;
            color: #367962;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .knowledge-help-box {
            background: #e7f5ff;
            border-left: 4px solid #0d6efd;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.6;
        }

        .knowledge-form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .knowledge-form-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .knowledge-form-label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .knowledge-form-input,
        .knowledge-form-select,
        .knowledge-form-textarea {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .knowledge-form-input:focus,
        .knowledge-form-select:focus,
        .knowledge-form-textarea:focus {
            outline: none;
            border-color: #367962;
            box-shadow: 0 0 0 3px rgba(54, 121, 98, 0.1);
        }

        .knowledge-form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Matriz de Risco */
        .risk-matrix {
            display: grid;
            grid-template-columns: 80px repeat(5, 1fr);
            grid-template-rows: 50px repeat(5, 80px);
            gap: 2px;
            background: #dee2e6;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
        }

        .risk-matrix-cell {
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 13px;
            padding: 8px;
            text-align: center;
        }

        .risk-matrix-header {
            background: #367962;
            color: white;
            font-weight: 700;
        }

        .risk-matrix-label {
            background: #f8f9fa;
            color: #495057;
            font-size: 12px;
        }

        .risk-level-very-low { background: #d1e7dd; color: #0f5132; cursor: pointer; }
        .risk-level-low { background: #cff4fc; color: #055160; cursor: pointer; }
        .risk-level-medium { background: #fff3cd; color: #664d03; cursor: pointer; }
        .risk-level-high { background: #ffe5d0; color: #984c0c; cursor: pointer; }
        .risk-level-very-high { background: #f8d7da; color: #842029; cursor: pointer; }

        .risk-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        .risk-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 15px;
            align-items: center;
        }

        .risk-item-info h4 {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .risk-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .knowledge-add-btn {
            background: #367962;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .knowledge-add-btn:hover {
            background: #22524C;
        }

        .knowledge-delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }

        .wbs-item {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 10px;
        }

        .wbs-item.level-1 { margin-left: 0; border-left: 4px solid #367962; }
        .wbs-item.level-2 { margin-left: 30px; border-left: 4px solid #51A65A; }
        .wbs-item.level-3 { margin-left: 60px; border-left: 4px solid #F5C745; }

        .header-stats {
            display: flex;
            gap: 15px;
            align-items: stretch;
        }

        .header-stat-box {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 20px 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
            min-width: 120px;
        }

        .header-stat-value {
            font-size: 32px;
            font-weight: 700;
            display: block;
            margin-bottom: 5px;
        }

        .header-stat-label {
            font-size: 11px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .header-progress-box {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            border-radius: 12px;
            border: 2px solid rgba(245,199,69,0.5);
            flex: 1;
            min-width: 300px;
        }

        .header-progress-title {
            font-size: 13px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .header-progress-main {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-progress-circle {
            width: 80px;
            height: 80px;
            position: relative;
            flex-shrink: 0;
        }

        .header-progress-value {
            font-size: 28px;
            font-weight: 800;
            color: #F5C745;
            text-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .header-progress-details {
            flex: 1;
        }

        .header-progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .header-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #F5C745 0%, #F9DE4B 50%, #51A65A 100%);
            transition: width 0.8s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            font-size: 12px;
            font-weight: 700;
            color: #22524C;
        }

        .header-progress-stats {
            display: flex;
            gap: 15px;
            font-size: 12px;
        }

        .header-progress-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .header-info {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0;
            padding: 20px 40px 25px 40px;
            position: relative;
            z-index: 1;
        }

        .header-info-item {
            padding: 15px 20px;
            border-right: 1px solid rgba(255,255,255,0.15);
            position: relative;
        }

        .header-info-item:last-child {
            border-right: none;
        }

        .header-info-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 40px;
            background: #F5C745;
            border-radius: 2px;
        }

        .header-info-item strong {
            display: block;
            font-size: 10px;
            text-transform: uppercase;
            opacity: 0.8;
            margin-bottom: 6px;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .header-info-item span {
            font-size: 14px;
            font-weight: 600;
            line-height: 1.4;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            padding: 30px 40px;
        }

        .tasks-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .section-title {
            color: #367962;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(180deg, #F5C745 0%, #51A65A 100%);
            border-radius: 2px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #367962 0%, #22524C 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(54, 121, 98, 0.3);
        }

        .btn-secondary {
            background: #F5C745;
            color: #22524C;
        }

        .btn-secondary:hover {
            background: #F9DE4B;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245, 199, 69, 0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-color: #367962;
        }

        .stat-label {
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #367962;
        }

        .stat-progress {
            margin-top: 12px;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        .stat-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #367962 0%, #51A65A 100%);
            transition: width 0.5s ease;
        }

        /* Estilos para as fases do projeto */
        .phase-container {
            margin-bottom: 30px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #e9ecef;
            background: white;
        }

        .phase-header {
            padding: 20px 25px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .phase-header:hover {
            background: #f8f9fa;
        }

        .phase-header.phase-iniciacao {
            background: linear-gradient(135deg, #367962 0%, #22524C 100%);
            color: white;
        }

        .phase-header.phase-planejamento {
            background: linear-gradient(135deg, #F5C745 0%, #F9DE4B 100%);
            color: #22524C;
        }

        .phase-header.phase-execucao {
            background: linear-gradient(135deg, #51A65A 0%, #367962 100%);
            color: white;
        }

        .phase-header.phase-monitoramento {
            background: linear-gradient(135deg, #2257C7 0%, #1a4494 100%);
            color: white;
        }

        .phase-header.phase-encerramento {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
        }

        .phase-title-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .phase-icon {
            font-size: 32px;
        }

        .phase-title-content h3 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .phase-subtitle {
            font-size: 13px;
            opacity: 0.9;
        }

        .phase-stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .phase-stat {
            text-align: center;
        }

        .phase-stat-value {
            font-size: 24px;
            font-weight: 700;
        }

        .phase-stat-label {
            font-size: 11px;
            text-transform: uppercase;
            opacity: 0.9;
        }

        .phase-progress-container {
            margin-top: 10px;
            width: 200px;
        }

        .phase-progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            overflow: hidden;
        }

        .phase-progress-fill {
            height: 100%;
            background: white;
            transition: width 0.5s ease;
        }

        .phase-content {
            padding: 20px 25px;
            display: none;
            background: #f8f9fa;
        }

        .phase-content.active {
            display: block;
        }

        .task-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .task-item:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border-color: #367962;
        }

        .task-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }

        .task-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
            margin-top: 2px;
            accent-color: #367962;
        }

        .task-info {
            flex: 1;
        }

        .task-title {
            font-size: 16px;
            font-weight: 600;
            color: #212529;
            margin-bottom: 8px;
        }

        .task-title input {
            width: 100%;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #212529;
            background: transparent;
            padding: 0;
        }

        .task-title input:focus {
            outline: none;
            border-bottom: 2px solid #367962;
        }

        .task-description {
            font-size: 13px;
            color: #6c757d;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .task-description textarea {
            width: 100%;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 8px 10px;
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
        }

        .task-description textarea:focus {
            outline: none;
            border-color: #367962;
        }

        .task-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 12px;
        }

        .task-meta-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 13px;
        }

        .task-meta-label {
            font-weight: 600;
            color: #6c757d;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .task-meta-item input,
        .task-meta-item select {
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 8px 10px;
            font-size: 13px;
        }

        .task-meta-item input:focus,
        .task-meta-item select:focus {
            outline: none;
            border-color: #367962;
        }

        .task-attachments {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #f1f3f5;
        }

        .attachments-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .attachments-title {
            font-weight: 600;
            color: #495057;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .attachment-upload-btn {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            color: #367962;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .attachment-upload-btn:hover {
            background: #367962;
            color: white;
            border-color: #367962;
        }

        .attachments-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .attachment-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .attachment-item:hover {
            background: #e9ecef;
            border-color: #dee2e6;
        }

        .attachment-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .attachment-icon {
            width: 32px;
            height: 32px;
            background: white;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            border: 1px solid #dee2e6;
        }

        .attachment-details {
            flex: 1;
        }

        .attachment-name {
            font-weight: 600;
            font-size: 13px;
            color: #212529;
            margin-bottom: 2px;
            word-break: break-all;
        }

        .attachment-meta {
            font-size: 11px;
            color: #6c757d;
        }

        .attachment-actions {
            display: flex;
            gap: 6px;
        }

        .attachment-action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .attachment-download-btn {
            background: #367962;
            color: white;
        }

        .attachment-download-btn:hover {
            background: #22524C;
        }

        .attachment-delete-btn {
            background: #dc3545;
            color: white;
        }

        .attachment-delete-btn:hover {
            background: #c82333;
        }

        .no-attachments {
            text-align: center;
            padding: 20px;
            color: #adb5bd;
            font-size: 13px;
            font-style: italic;
        }

        /* Modal de detalhamento */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, #367962 0%, #22524C 100%);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid #F5C745;
        }

        .modal-header h2 {
            font-size: 22px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 25px 30px;
            max-height: calc(80vh - 100px);
            overflow-y: auto;
        }

        .modal-task-item {
            background: #f8f9fa;
            border-left: 4px solid #367962;
            padding: 15px 20px;
            margin-bottom: 12px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .modal-task-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .modal-task-title {
            font-weight: 600;
            color: #212529;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .modal-task-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 13px;
            color: #6c757d;
        }

        .modal-task-meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .modal-empty {
            text-align: center;
            padding: 40px 20px;
            color: #adb5bd;
        }

        .modal-empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .modal-empty-text {
            font-size: 16px;
            font-weight: 600;
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-color: #367962;
        }

        .stat-card-clickable {
            position: relative;
        }

        .stat-card-clickable::after {
            content: '🔍';
            position: absolute;
            top: 10px;
            right: 10px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .stat-card-clickable:hover::after {
            opacity: 0.5;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            display: inline-block;
        }

        .status-nao-iniciada {
            background: #e9ecef;
            color: #495057;
        }

        .status-em-andamento {
            background: #cfe2ff;
            color: #084298;
        }

        .status-concluida {
            background: #d1e7dd;
            color: #0f5132;
        }

        .status-atrasada {
            background: #f8d7da;
            color: #842029;
        }

        .status-em-revisao {
            background: #fff3cd;
            color: #664d03;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .calendar-widget {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-header h3 {
            color: #367962;
            font-size: 18px;
            font-weight: 700;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav button {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-weight: 600;
            color: #367962;
        }

        .calendar-nav button:hover {
            background: #367962;
            color: white;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day-header {
            text-align: center;
            font-size: 11px;
            font-weight: 700;
            color: #6c757d;
            padding: 8px;
            text-transform: uppercase;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .calendar-day:hover {
            background: #f8f9fa;
        }

        .calendar-day.today {
            background: #367962;
            color: white;
            font-weight: 700;
        }

        .calendar-day.has-event::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 6px;
            height: 6px;
            background: #F5C745;
            border-radius: 50%;
        }

        .calendar-day.other-month {
            color: #adb5bd;
        }

        .events-list {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
        }

        .event-item {
            padding: 12px;
            background: #f8f9fa;
            border-left: 4px solid #367962;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 13px;
        }

        .event-date {
            font-weight: 700;
            color: #367962;
            margin-bottom: 5px;
        }

        .event-title {
            color: #212529;
        }

        .add-event-form {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e9ecef;
        }

        .add-event-form input {
            width: 100%;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 13px;
        }

        .add-event-form input:focus {
            outline: none;
            border-color: #367962;
        }

        .task-completed {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .task-completed .task-title {
            text-decoration: line-through;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .delete-btn:hover {
            background: #c82333;
            transform: scale(1.05);
        }

        .add-task-btn {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            color: #6c757d;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .add-task-btn:hover {
            background: white;
            border-color: #367962;
            color: #367962;
        }

        .pmbok-info {
            background: #fff3cd;
            border-left: 4px solid #F5C745;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #664d03;
        }

        .pmbok-info strong {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .main-content {
                padding: 20px;
            }

            .phase-stats {
                flex-direction: column;
                gap: 10px;
            }

            .task-meta {
                grid-template-columns: 1fr;
            }
        }

        .toggle-icon {
            transition: transform 0.3s;
        }

        .toggle-icon.rotated {
            transform: rotate(180deg);
        }
    </style>
</head>
<body>
    <div class="breadcrumb">
        <a href="index.html">🏠 Início</a>
        <span class="breadcrumb-separator">›</span>
        <a href="unit.html" id="breadcrumbUnit">Unidade</a>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-current" id="breadcrumbProject">Projeto</span>
    </div>
    <div class="container">
        <div class="header">
            <div class="header-top">
                <div class="header-logo-section">
                    <div class="header-logo">
                        <img src="data:image/webp;base64,UklGRn4PAABXRUJQVlA4WAoAAAAgAAAA4AAA4AAASUNDUMgBAAAAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADZWUDggkA0AADBGAJ0BKuEA4QA+USiRRiOioaEjs7l4cAoJY27hdrEDXt/XdhF7L50lZ/q/ggeP0TL1Z9zvzP9m/Nb4I/4D2L/n3/L+4B+nX64dZjzAfsl+6Hur/6H9O/c76AH9E/wH//7Br0Bv3D9NH9w/g//sX+//cT2wc1Q/vnbd/oeWO9seYZ1F4pftn+x/sH7fclfqk9QL17/nN5PAB+df13/P+FrqL+EPNV/4/HT+jewB/LP8l/2/Uz/6/8p58fzz/N/+f/PfAZ/Nv7z1hv3G9kYavbuXpLtl0ZJjCpYP4Zrh7dy9JcWgrEeut7ULKGXjyrnJMYL/zZO7ieRqiBSoEPbSXbLnCZdAWWUKEkdvVm+r3BS/8LCSXbLox7oFt7kssfaSY6anpLtl0VwCKyvHc+Kx0D73UbSxmwzjcKTPnpLtl0V056RjNj6eRmLbJP7WQwgRK28kMnlPYyyUYWDkRsVb3Nc/YOQG1QKvESYFV/6vEG/Cd3ZYWS1fvsPu/UBfVTiFoGH6uriYU0LFORW7dwLpJkJ2olUIgjdnjrYuJsNeuuiAnSqG7N1KNkbvAiBgpDj+deRPAxJfqLxKFUTKdpIDj5kPczejV1G/2REhjdXpLr5+9JFJjVqW71ohZzixRbbuh4gEhy8XaCiq+9aiD2JMhuGNaHBQakiejL+7XqRtYnSWqM1Ra3AaYBcYKCu/D9IE6EMK0nsnZ3x5eszSmIPAjTD27l6S7ZdGSYw9u5eku2XRkmMPbuXpLtlmAAD+/+TfAAh5yWJ2GvbPH5P3BuN0pvl4q/2XbR2NCzIf+se5KPdl5h/BVrgeiR9k89IxtXDbf4AZ8gUeqzQy5NWz746xCRl/TyR2Tbe8frC40whZFM9Ru9iE9Pdq58h9MO4vUhrRVuJi9YaSHPM5IEXn1lRvNnHdmbmkhrEK3QiE9nldrW4q33KrOOc1iNKd9yKLJR62pMFvDeljClCBNukbHBNQ+3TWJC7h98K/gd7DgPbkyucFhRjhjXSMDlUIw/xN7JTY4pxrpnXw3ICBCzYUyclqI1dPegJA3DRaRcNGnhXjYFjZq5JxDH1cQWScxKaKigixhGLhITY63T50StD+x+MmoTA9SVz/n21BIGW2/mn1Fidf9cdPQK1As+jkwV0T7dlLsEccJsz0OWfsJTrK/WCPivqxyW0F73+kVG0udDIoKfDUQobr7dVT9hIwe3d0oasM8CtFCjmx7RPzubgmZTg1roNI7eylraR8DeBf8XcUyfqNO+NhoDJJnahi0BnLN6zxZnnuldikR/+vw/tXHyUYrdiUBfrpbfnShmXDD0lROpSmqCSUTjs62s6SF4oFDM+r9WnTKGuTZ10AhZjt78gnb43Wvt5AZYXYaMbEo9Ef21BKb+AXHYBzBAK1M44ojVxMh2ZbYrlpuEvcxYzf2hFOyZSIyxtcwOsa6A8aaxv7kXh5oNAV+LGHUGRmrPCGBnmILpdPOAGir92nCHSB+dDaKyOVWNRAX/hrtydEgdY/tCB9MVL5j7YbWV/xI+JX4tmF3AkC0RDPNr6bqxd4a0bh6xfz7JvvMGUCGOccGJRUXiT+Zjip2TMxB61a8WWoaJ0C81llNAEJOpSsxYHvIjdpIRLtxMQRFYmOVmy7cCa+LaQ3i915nvAzqgh+wiDH5+yl+7tCdlwBK8iOb28urr4ePo0KyDWUL8zmtn7ykKYdTOz8TWAPWcDzXeXn2FLo1n+h3L5jvc8HuYYLTo50Z0O+gcajsVpZxFNDNovau3vQ5Wj88gowgCIyIQtDsTv9VQo1mTHQpy0/BKrJThDlaTP4F2pfJEV4EEdK2CnacJo/cSp4bqYCAZTLdsqBDp0c2wjNXxbCu8SY9fr5mIH3RzM/liCF0Ywiyq1g2u7KbUsTdwk2IXvFlySBgNbSKXoHBGGw8q5Ox7TLGCfEm875kz9Jchcf4YfIyWR3NJU1D6JT0DFi+DqGk0A/QAh+wQezTY7brCiXkTEK3mNR3JIMyWDXUeUxLY33Oy/bRqCGI+keTVUgwp/YwCbh9++0DeaQHAklVMXVeruNYmwSM87/uzBFXtLYGty2x/E4CKRLA8NYRyT7WzIn5CcQH7gCBTkkGaN/rI6r28o+qf5k+QH+4QbZYYn7JW9mogNEjB0Uhg1wR+bJNltX1Hd7RxBANrRE4FYRLF/fyTQvWt/waqJXWUrnSuaUGBP5xprDXGjjEJXVz8Ud26TK3vRArpQWv1jarU+HvkOXe99Kj9co7wRvvbHKhQUgbwF4QmopRoaOIFgOWe/TXZ/F5UCoKyjH4OlsvL/bFUKIt0AuZuq1xHPMPr2DVGCt7XEmnKxOiQdvz32mHnyeetXyDqmP1y8JL5vD/vuNP9Mt3u4G6hsQysQmNfxwQt32HsrmoJzX3esB/gyPyY5ndnOklp8R2sb/vXb9SoZ/dualL9la1FbqwIywfhqmhlYfzJw7axHlMbd0q6D0imWLEkwAnfL/6ic5H72Nce5/pbCNgYCXdBYfuNFudlMlmXBKqHax/N/fn8BquWusDZOEDQFxlgsEODMgGXmvH4oIaZNGGG4kBUQlIW2ikMtx3mF8euWmjavOKkdezvv3XVie8NMT32eOAn5gstDYdlHETFZeRU1FKhTwIfP0sNFIfCFMp2cVeyA40Os8j7I88gMcm6j/TQCx9U+4vbc10yhA5Yb+JW+mrDi3RMVNuTzDgPyKy5PHpAdgGR4ddbzhlRMIviJ9LoNL3HtgwxX+96xHHHxlDcqbJ163nl/lEQYaXBB+Hwhi1eAGaf16fRyR9TQ73agNt2600EW3Ze8AISHHd1N0AXSIMwHG9o4s8VxyrMA6K81WS7NrO+J7VQv2RXyTRwsvcLi3vxTT3m+dgD84lpSFDtIPlnXxeGYRYK8cUpk4CETkyQvuUHxFf6X6OgeFuZr7UsETDlFMmRNFYUOa3MYwqZEVn7oYiGRCF7Y2sm6/geW0y9gT/eSRjcYL83SXmZnViWalWuq/8QcctfP4lfkwsBfnTLQkTity5f8+B7qhlXr2SxgWu1LhQS5xnP+GX/2ncv+c0EXVCRfdeCPA8Iy3cHoTnC+Kgb1mkbKVUKFe2hCjWJteidGr7vffEl40xCDl5H02bPc8it9pTuinyqQgZ/yDM/Klrh2Qhl7nXIUxz+oosT3/0LQGryLO2aOvt+ns/oIImQegbLZHdWbamnwbERlTYZ5u2luxZVIL7Bnqko2QMCewmK6TTkrDpvkF0mmZlXMrWMw46JgNt0sGbP0+5uxFSmMgEWSsKX+zVrduRHq9wgVjsxm/PpChTKl6D2twsr3Q2AveSHmHi+46G0j4z2FhcRF1z4ECpf7WIc0yBR8Hv72FWvhCpveY90aJ8Rj6U9jLLVNkJWkuSTn05KeLGZa02jUYl5gwgWBfVRt+SIkRzfpR1fQikd6Wia/XOe71yyi/yo/ge4gFrt9OURI3tGVz0gA+WgUiameInogyEwYtUFCORstg9zXtGOeCx28w6X/8Z9d2/f1qQjKr/TDbPLEus9VhjaFiyYEvqSS2Whgg4PZlkADk0Rs8P/FWA9cZO8A22kDlZpvCjR8apclU/B4lDw1RuaaysUGxRjp8aNzKOxhgaP92No6uB+LfA+W3ZgTQbL45/TU8tJ85HnDwgkdfrbqNd+QtW8XgctmQUilVNrjcNqyjF8bXPzASbMwfqJvD9thLMjwTrym8yaMCpIlvZjc7GA/PeC1H+A+RxEQcPEgI8MjmkmtnbtBRrnoNDR13VL0547FnrUZRrtvJPNG35/4Kacr2hFTjkTpU5A0Fsbx3ElOGUJFX4q29/iSIoD/YQQ5m1GuLuPdQf8YHhDZbcIbpdS0/H2tUOkbIZmUiWKrXwF6/Yvw9gOfmAnG06zHJMG/8zlG5VMfEKoQJiTTFKWOJ1D74jKJ1BJY3MbJRHAwe7ZYEp2XBR9mjFlkAchdBLXf8X4U33+IMlEup4VImuMV6r9RN4f/YXpFSfA3mXvsiLB7y5LqQqrsLdq2CCvaQRNteA/fQafGnyM6q4DzCUnxBdpgUR8oT6mbi8bz5m8V88xClbEQjihz29MLk7Ye2msX//U9ZounsA8wnlm6pSvMOjp35Vs00gYPyr2IvGiyNPQxyDIxKbSeLnEGH+JFoqD8Cfv+HVRBfznoMAuNXcUUZe0P5c/JhT4zz+v4po4EShwXY25oJi8vNm39O8WmojVYmouO9/81AxzZXxUGtvFKzvyfEj/PlTieUE8avdXSTJPqCbKDMnmLGy8iyCekgeQRR6wGzOb0LGXdQUZYinkQ+8S12P8Us7cF0gIV2XQpF5wpMfhPg8lsWkVA2+8clHlpwwAaZcwhHqYZXw20d36/QQd51mWG56aQyVAcj8yqHD0Uwj7uv/prfkvbtlAOhGIbrsHZXV9+pjtiSvMeGNE/4j8syBNCbvK0d1KE34x/NK2Dw8kGiz/tmuFDKi3f/cDZBLPYv8mn7IVU2xgtfCdE/3lelZeftCUrWOx7Sd3KlLVxsNfr6Pp8KYx4YBGx/daK/FcYdcPT+/YrGt6BJ0PZrXvV8wLU0CjmnU9GZcbEfPLcT1qynMgBD8V/IrPcLd7Z0nQUiU5P/B/3Pml1bdw4bgAAAAAAAAAA=" alt="Logo Cuiabá" style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="header-title-section">
                        <h1>Sistema de Gestão de Projetos</h1>
                        <div class="header-subtitle" id="headerProjectName">
                            Integração Planejamento Estratégico e Orçamento
                        </div>
                        <div style="font-size: 11px; opacity: 0.7; margin-top: 5px;">
                            Metodologia PMBOK • Responsável Técnica: Jéssika Oliveira
                        </div>
                    </div>
                </div>
                <div class="header-stats">
                    <div class="header-progress-box">
                        <div class="header-progress-title">📊 Progresso Geral do Projeto</div>
                        <div class="header-progress-main">
                            <div class="header-progress-circle">
                                <div class="header-progress-value" id="headerProgressValue">0%</div>
                            </div>
                            <div class="header-progress-details">
                                <div class="header-progress-bar">
                                    <div class="header-progress-fill" id="headerProgressBar" style="width: 0%">
                                        <span id="headerProgressText">0%</span>
                                    </div>
                                </div>
                                <div class="header-progress-stats">
                                    <div class="header-progress-stat">
                                        <span>✅</span>
                                        <span><strong id="headerCompletedCount">0</strong> concluídas</span>
                                    </div>
                                    <div class="header-progress-stat">
                                        <span>📝</span>
                                        <span><strong id="headerTotalCount">0</strong> total</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="header-stat-box">
                        <span class="header-stat-value" id="headerPhases">0/5</span>
                        <span class="header-stat-label">Fases Completas</span>
                    </div>
                </div>
            </div>
            <div class="header-info">
                <div class="header-info-item" style="grid-column: 1 / -1; border-right: none; border-bottom: 1px solid rgba(255,255,255,0.15); padding: 12px 20px;">
                    <strong>🏛️ ÓRGÃO</strong>
                    <span style="font-size: 15px;">Secretaria de Planejamento Estratégico e Orçamento</span>
                </div>
                <div class="header-info-item">
                    <strong>👔 Secretário</strong>
                    <span>Murilo Bianchini</span>
                </div>
                <div class="header-info-item">
                    <strong>👩‍💼 Secretária Adjunta</strong>
                    <span>Patrícia Alonço</span>
                </div>
                <div class="header-info-item" style="grid-column: 3 / -1; border-right: none;">
                    <strong>📊 Diretora Técnica de Governança</strong>
                    <span>Jéssika Oliveira</span>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="tasks-section">
                <div class="section-title">📊 Dashboard de Progresso Geral</div>
                
                <div class="pmbok-info">
                    <strong>Metodologia de Gestão de Projetos</strong>
                    O projeto está estruturado nas 5 fases clássicas: Iniciação, Planejamento, Execução, Monitoramento e Controle, e Encerramento.
                </div>

                <!-- Seção de Configuração do Projeto -->
                <div class="project-config-card">
                    <div class="project-config-header">
                        <div class="project-config-title">
                            <span class="project-config-icon">📝</span>
                            <span>Configuração do Projeto</span>
                        </div>
                    </div>
                    <div class="project-config-body">
                        <div class="project-name-edit-container">
                            <label for="projectNameInput" class="project-name-edit-label">
                                Nome do Projeto:
                            </label>
                            <div class="project-name-edit-field">
                                <input 
                                    type="text" 
                                    id="projectNameInput" 
                                    value="Integração Planejamento Estratégico e Orçamento"
                                    placeholder="Digite o nome do projeto"
                                    onblur="updateProjectName()"
                                    onkeypress="if(event.key === 'Enter') { this.blur(); }"
                                />
                                <span class="project-name-edit-hint">
                                    💡 Este nome aparecerá no cabeçalho e será usado para identificar o projeto
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total de Tarefas</div>
                        <div class="stat-value" id="totalTasks">0</div>
                    </div>
                    <div class="stat-card stat-card-clickable" onclick="showTaskDetails('completed')">
                        <div class="stat-label">Concluídas</div>
                        <div class="stat-value" id="completedTasks">0</div>
                        <div class="stat-progress">
                            <div class="stat-progress-bar" id="completedProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="stat-card stat-card-clickable" onclick="showTaskDetails('inProgress')">
                        <div class="stat-label">Em Andamento</div>
                        <div class="stat-value" id="inProgressTasks">0</div>
                    </div>
                    <div class="stat-card stat-card-clickable" onclick="showTaskDetails('delayed')">
                        <div class="stat-label">Atrasadas</div>
                        <div class="stat-value" id="delayedTasks" style="color: #dc3545;">0</div>
                    </div>
                </div>

                <!-- Scrumban Board -->
                <div class="scrumban-section">
                    <div class="section-title">📋 Painel de Tarefas</div>
                    <div class="pmbok-info" style="margin-bottom: 20px;">
                        💡 <strong>Painel de Tarefas</strong> - Arraste as tarefas entre as colunas para atualizar o status. Use os filtros para facilitar a visualização.
                    </div>
                    
                    <div class="scrumban-controls">
                        <div class="scrumban-filters">
                            <div class="scrumban-filter-group">
                                <label class="scrumban-filter-label">📂 Fase:</label>
                                <select class="scrumban-filter-select" id="scrumbanPhaseFilter" onchange="filterScrumban()">
                                    <option value="all">Todas as Fases</option>
                                    <option value="iniciacao">🚀 Iniciação</option>
                                    <option value="planejamento">📋 Planejamento</option>
                                    <option value="execucao">⚙️ Execução</option>
                                    <option value="monitoramento">📊 Monitoramento</option>
                                    <option value="encerramento">✅ Encerramento</option>
                                </select>
                            </div>
                            
                            <div class="scrumban-search">
                                <span class="scrumban-search-icon">🔍</span>
                                <input type="text" id="scrumbanSearchInput" 
                                       placeholder="Buscar tarefa..." 
                                       onkeyup="filterScrumban()">
                            </div>
                        </div>
                        
                        <button class="scrumban-expand-btn" onclick="toggleScrumbanExpand()">
                            <span id="scrumbanExpandIcon">⬇️</span>
                            <span id="scrumbanExpandText">Expandir</span>
                        </button>
                    </div>
                    
                    <div class="scrumban-board" id="scrumbanBoard">
                        <!-- Será preenchido dinamicamente -->
                    </div>
                </div>

                <div class="section-title">🗂️ Fases do Projeto</div>

                <div class="controls">
                    <button class="btn btn-secondary" onclick="exportData()">
                        💾 Exportar Dados
                    </button>
                    <button class="btn btn-secondary" onclick="importData()">
                        📁 Importar Dados
                    </button>
                    <button class="btn btn-secondary" onclick="toggleAllPhases()">
                        📂 Expandir/Recolher Todas
                    </button>
                </div>

                <div id="phasesList"></div>

                <!-- Seção das 10 Áreas de Conhecimento do PMBOK -->
                <div class="section-title" style="margin-top: 40px;">📚 Áreas de Conhecimento do Projeto</div>
                
                <div class="knowledge-areas-intro">
                    💡 <strong>As 10 Áreas de Conhecimento do PMBOK</strong> representam os principais campos de especialização necessários para o gerenciamento eficaz de projetos. Documente aqui as informações específicas de cada área para o seu projeto.
                </div>

                <div id="knowledgeAreasList" class="knowledge-areas-container">
                    <!-- Será preenchido dinamicamente -->
                </div>
            </div>

            <div class="sidebar">
                <div class="calendar-widget">
                    <button class="calendar-expand-btn" onclick="openCalendarModal()">
                        🔍 Expandir
                    </button>
                    <div class="calendar-header">
                        <h3>📅 Calendário</h3>
                        <div class="calendar-nav">
                            <button onclick="changeMonth(-1)">◀</button>
                            <button onclick="changeMonth(1)">▶</button>
                        </div>
                    </div>
                    <div id="currentMonth" style="text-align: center; font-weight: 700; color: #367962; margin-bottom: 15px;"></div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>

                <div class="events-list">
                    <h3 style="color: #367962; font-size: 18px; font-weight: 700; margin-bottom: 15px;">📌 Próximos Compromissos</h3>
                    <div id="eventsList"></div>
                    <div class="add-event-form">
                        <input type="date" id="eventDate" placeholder="Data">
                        <input type="text" id="eventTitle" placeholder="Descrição do compromisso">
                        <button class="btn btn-primary" onclick="addEvent()" style="width: 100%;">Adicionar Compromisso</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalhamento -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Detalhamento de Tarefas</h2>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Conteúdo será inserido dinamicamente -->
            </div>
        </div>
    </div>

    <!-- Modal de Calendário Expandido -->
    <div id="calendarModal" class="calendar-modal">
        <div class="calendar-modal-content">
            <div class="calendar-modal-header">
                <h2>📅 Calendário Completo do Projeto</h2>
                <button class="modal-close" onclick="closeCalendarModal()">×</button>
            </div>
            <div class="calendar-modal-body">
                <div class="calendar-modal-calendar">
                    <div class="calendar-header">
                        <h3 id="modalCurrentMonth" style="text-align: center; font-weight: 700; color: #367962; margin-bottom: 15px;"></h3>
                        <div class="calendar-nav" style="justify-content: center; margin-bottom: 20px;">
                            <button onclick="changeModalMonth(-1)">◀ Anterior</button>
                            <button onclick="changeModalMonth(1)">Próximo ▶</button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="modalCalendarGrid" style="font-size: 16px;"></div>
                </div>
                <div class="calendar-modal-tasks">
                    <h3 class="calendar-modal-tasks-title" id="selectedDateTitle">Selecione uma data</h3>
                    <div id="modalTasksList">
                        <p style="text-align: center; color: #adb5bd; padding: 40px 20px;">
                            Clique em um dia do calendário para ver as tarefas
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Área de Conhecimento -->
    <div id="knowledgeModal" class="knowledge-modal">
        <div class="knowledge-modal-content">
            <div class="knowledge-modal-header">
                <div class="knowledge-modal-title-section">
                    <div class="knowledge-modal-icon" id="modalAreaIcon">📊</div>
                    <div class="knowledge-modal-title-text">
                        <h2 id="modalAreaName">Área de Conhecimento</h2>
                        <p id="modalAreaDescription">Descrição da área</p>
                    </div>
                </div>
                <button class="modal-close" onclick="closeKnowledgeModal()">×</button>
            </div>
            <div class="knowledge-modal-body" id="modalAreaContent">
                <!-- Conteúdo será inserido dinamicamente -->
            </div>
        </div>
    </div>

    <script>
        // Estrutura de dados baseada em PMBOK
        let phases = {
            iniciacao: {
                name: "Iniciação",
                icon: "🚀",
                subtitle: "Definição e autorização do projeto",
                color: "iniciacao",
                tasks: [
                    {
                        id: 1,
                        title: "Elaboração do Termo de Abertura do Projeto (TAP)",
                        description: "Documentar formalmente o projeto, seus objetivos, escopo preliminar, stakeholders e recursos necessários",
                        responsible: "Jéssika Oliveira",
                        startDate: "2025-01-13",
                        endDate: "2025-01-17",
                        status: "em-andamento",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 2,
                        title: "Identificação dos Stakeholders",
                        description: "Mapear todas as partes interessadas: secretarias, unidades orçamentárias, equipe técnica, alta gestão",
                        responsible: "Patrícia Alonço",
                        startDate: "2025-01-15",
                        endDate: "2025-01-20",
                        status: "em-andamento",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 3,
                        title: "Reunião de Kickoff do Projeto",
                        description: "Apresentar o projeto oficialmente, alinhar expectativas e definir canais de comunicação",
                        responsible: "Murilo Bianchini",
                        startDate: "2025-01-20",
                        endDate: "2025-01-20",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    }
                ]
            },
            planejamento: {
                name: "Planejamento",
                icon: "📋",
                subtitle: "Definição do escopo, cronograma e recursos",
                color: "planejamento",
                tasks: [
                    {
                        id: 4,
                        title: "Definição detalhada do Escopo",
                        description: "Criar a EAP (Estrutura Analítica do Projeto), definir entregas e critérios de aceitação",
                        responsible: "Jéssika Oliveira",
                        startDate: "2025-01-22",
                        endDate: "2025-01-29",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 5,
                        title: "Levantamento das Metas do Planejamento Estratégico",
                        description: "Coletar e documentar todas as metas estratégicas que serão vinculadas ao orçamento",
                        responsible: "Equipe Técnica",
                        startDate: "2025-01-27",
                        endDate: "2025-02-05",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 6,
                        title: "Mapeamento das Unidades Orçamentárias",
                        description: "Identificar todas as UOs e sua estrutura atual de dados no sistema",
                        responsible: "Equipe Técnica",
                        startDate: "2025-01-29",
                        endDate: "2025-02-07",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 7,
                        title: "Definição de Indicadores de Acompanhamento",
                        description: "Estabelecer KPIs para medir o progresso das metas e execução orçamentária",
                        responsible: "Patrícia Alonço",
                        startDate: "2025-02-03",
                        endDate: "2025-02-12",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 8,
                        title: "Planejamento de Recursos e Cronograma",
                        description: "Definir recursos humanos, tecnológicos e prazos detalhados do projeto",
                        responsible: "Jéssika Oliveira",
                        startDate: "2025-02-10",
                        endDate: "2025-02-14",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 9,
                        title: "Plano de Gerenciamento de Riscos",
                        description: "Identificar riscos potenciais e definir estratégias de mitigação",
                        responsible: "Todos",
                        startDate: "2025-02-12",
                        endDate: "2025-02-17",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    }
                ]
            },
            execucao: {
                name: "Execução",
                icon: "⚙️",
                subtitle: "Desenvolvimento e implementação da solução",
                color: "execucao",
                tasks: [
                    {
                        id: 10,
                        title: "Estruturação do Modelo de Vinculação Meta-Orçamento",
                        description: "Criar a arquitetura de dados que conectará metas estratégicas às unidades orçamentárias",
                        responsible: "Jéssika Oliveira",
                        startDate: "2025-02-17",
                        endDate: "2025-02-26",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 11,
                        title: "Desenvolvimento da Integração no Power BI",
                        description: "Construir dashboards e relatórios que integrem dados do PE com execução orçamentária",
                        responsible: "Equipe Técnica",
                        startDate: "2025-02-24",
                        endDate: "2025-03-12",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 12,
                        title: "Configuração de Atualizações em Tempo Real",
                        description: "Implementar conexões automáticas para atualização contínua dos dados",
                        responsible: "Equipe Técnica",
                        startDate: "2025-03-03",
                        endDate: "2025-03-14",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 13,
                        title: "Criação de Documentação Técnica",
                        description: "Elaborar manuais de uso e documentação do sistema desenvolvido",
                        responsible: "Equipe Técnica",
                        startDate: "2025-03-10",
                        endDate: "2025-03-19",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    }
                ]
            },
            monitoramento: {
                name: "Monitoramento e Controle",
                icon: "📊",
                subtitle: "Acompanhamento e ajustes do projeto",
                color: "monitoramento",
                tasks: [
                    {
                        id: 14,
                        title: "Testes de Validação do Sistema",
                        description: "Realizar testes funcionais, de integração e de performance",
                        responsible: "Todos",
                        startDate: "2025-03-12",
                        endDate: "2025-03-24",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 15,
                        title: "Validação com Stakeholders",
                        description: "Apresentar o sistema às secretarias e coletar feedback",
                        responsible: "Patrícia Alonço",
                        startDate: "2025-03-19",
                        endDate: "2025-03-26",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 16,
                        title: "Ajustes e Melhorias",
                        description: "Implementar correções e melhorias baseadas no feedback recebido",
                        responsible: "Equipe Técnica",
                        startDate: "2025-03-24",
                        endDate: "2025-04-02",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 17,
                        title: "Acompanhamento de Desempenho",
                        description: "Monitorar métricas de uso e performance do sistema",
                        responsible: "Jéssika Oliveira",
                        startDate: "2025-03-26",
                        endDate: "2025-04-09",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    }
                ]
            },
            encerramento: {
                name: "Encerramento",
                icon: "🎯",
                subtitle: "Entrega final e lições aprendidas",
                color: "encerramento",
                tasks: [
                    {
                        id: 18,
                        title: "Treinamento das Equipes",
                        description: "Capacitar usuários finais no uso do sistema integrado",
                        responsible: "Murilo Bianchini",
                        startDate: "2025-04-02",
                        endDate: "2025-04-11",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 19,
                        title: "Apresentação Final e Implantação",
                        description: "Apresentar resultados finais e colocar o sistema em produção",
                        responsible: "Diretoria",
                        startDate: "2025-04-09",
                        endDate: "2025-04-16",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 20,
                        title: "Documentação de Lições Aprendidas",
                        description: "Registrar aprendizados, sucessos e oportunidades de melhoria",
                        responsible: "Jéssika Oliveira",
                        startDate: "2025-04-14",
                        endDate: "2025-04-18",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    },
                    {
                        id: 21,
                        title: "Encerramento Formal do Projeto",
                        description: "Obter aceite formal das entregas e encerrar contratos/recursos",
                        responsible: "Murilo Bianchini",
                        startDate: "2025-04-16",
                        endDate: "2025-04-21",
                        status: "nao-iniciada",
                        completed: false,
                        attachments: []
                    }
                ]
            }
        };

        let events = [
            { date: "2025-01-15", title: "Reunião: Identificação de Stakeholders" },
            { date: "2025-01-20", title: "Reunião de Kickoff do Projeto" },
            { date: "2025-02-05", title: "Revisão de Metas e Indicadores" },
            { date: "2025-02-17", title: "Início do Desenvolvimento Power BI" },
            { date: "2025-03-19", title: "Validação com Stakeholders" },
            { date: "2025-04-09", title: "Apresentação Final" }
        ];

        let currentMonth = new Date();
        let expandedPhases = {};
        let projectName = "Integração Planejamento Estratégico e Orçamento";
        let stakeholders = [
            { id: 1, name: "Murilo Bianchini", role: "Secretário", level: "Patrocinador" },
            { id: 2, name: "Patrícia Alonço", role: "Secretária Adjunta de Planejamento", level: "Patrocinador" },
            { id: 3, name: "Jéssika Oliveira", role: "Diretora Técnica de Governança", level: "Gerente de Projeto" }
        ];
        let knowledgeAreas = {
            integracao: {
                name: "Integração",
                icon: "🔗",
                description: "Coordenação de todos os aspectos do projeto",
                notes: "",
                attachments: []
            },
            escopo: {
                name: "Escopo",
                icon: "📐",
                description: "Definição e controle do que está incluído no projeto",
                notes: "",
                attachments: []
            },
            cronograma: {
                name: "Cronograma",
                icon: "📅",
                description: "Gerenciamento de prazos e marcos do projeto",
                notes: "",
                attachments: []
            },
            custos: {
                name: "Custos",
                icon: "💰",
                description: "Planejamento e controle do orçamento",
                notes: "",
                attachments: []
            },
            qualidade: {
                name: "Qualidade",
                icon: "⭐",
                description: "Garantia de atendimento aos requisitos",
                notes: "",
                attachments: []
            },
            recursos: {
                name: "Recursos",
                icon: "👥",
                description: "Gestão de equipe e recursos físicos",
                notes: "",
                attachments: []
            },
            comunicacao: {
                name: "Comunicação",
                icon: "📢",
                description: "Planejamento e distribuição de informações",
                notes: "",
                attachments: []
            },
            riscos: {
                name: "Riscos",
                icon: "⚠️",
                description: "Identificação e mitigação de riscos",
                notes: "",
                attachments: []
            },
            aquisicoes: {
                name: "Aquisições",
                icon: "🛒",
                description: "Compras e contratações necessárias",
                notes: "",
                attachments: []
            },
            partes_interessadas: {
                name: "Partes Interessadas",
                icon: "🤝",
                description: "Engajamento e gerenciamento de stakeholders",
                notes: "",
                attachments: []
            }
        };

        // Salvar no localStorage
        function saveData() {
            localStorage.setItem('phases', JSON.stringify(phases));
            localStorage.setItem('events', JSON.stringify(events));
            localStorage.setItem('expandedPhases', JSON.stringify(expandedPhases));
            localStorage.setItem('projectName', projectName);
            localStorage.setItem('stakeholders', JSON.stringify(stakeholders));
            localStorage.setItem('knowledgeAreas', JSON.stringify(knowledgeAreas));
        }

        // Carregar do localStorage
        function loadData() {
            const savedPhases = localStorage.getItem('phases');
            const savedEvents = localStorage.getItem('events');
            const savedExpanded = localStorage.getItem('expandedPhases');
            const savedProjectName = localStorage.getItem('projectName');
            const savedStakeholders = localStorage.getItem('stakeholders');
            const savedKnowledgeAreas = localStorage.getItem('knowledgeAreas');
            
            if (savedPhases) phases = JSON.parse(savedPhases);
            if (savedEvents) events = JSON.parse(savedEvents);
            if (savedExpanded) expandedPhases = JSON.parse(savedExpanded);
            if (savedProjectName) projectName = savedProjectName;
            if (savedStakeholders) stakeholders = JSON.parse(savedStakeholders);
            if (savedKnowledgeAreas) knowledgeAreas = JSON.parse(savedKnowledgeAreas);
        }

        // Atualizar nome do projeto
        function updateProjectName() {
            const input = document.getElementById('projectNameInput');
            const headerDisplay = document.getElementById('headerProjectName');
            projectName = input.value || "Nome do Projeto";
            headerDisplay.textContent = projectName;
            saveData();
        }

        // Renderizar stakeholders
        // Renderizar Stakeholders (mantida para compatibilidade, mas agora dentro das áreas)
        function renderStakeholders() {
            // Stakeholders agora são renderizados dentro da área de conhecimento
            // Esta função mantida para não quebrar referências, mas agora chama renderKnowledgeAreas
            renderKnowledgeAreas();
        }

        // Adicionar stakeholder
        function addStakeholder() {
            const maxId = stakeholders.length > 0 ? Math.max(...stakeholders.map(s => s.id)) : 0;
            stakeholders.push({
                id: maxId + 1,
                name: "Novo Stakeholder",
                role: "Cargo/Função",
                level: "Interessado"
            });
            saveData();
            renderKnowledgeAreas();
            
            // Expandir automaticamente a área de Partes Interessadas
            if (!expandedKnowledgeAreas['partes_interessadas']) {
                expandedKnowledgeAreas['partes_interessadas'] = true;
                renderKnowledgeAreas();
            }
        }

        // Atualizar stakeholder
        function updateStakeholder(id, field, value) {
            const stakeholder = stakeholders.find(s => s.id === id);
            if (stakeholder) {
                stakeholder[field] = value;
                saveData();
                renderKnowledgeAreas();
            }
        }

        // Deletar stakeholder
        function deleteStakeholder(id) {
            if (confirm('Tem certeza que deseja remover este stakeholder?')) {
                stakeholders = stakeholders.filter(s => s.id !== id);
                saveData();
                renderKnowledgeAreas();
            }
        }

        // Renderizar Scrumban Board
        let scrumbanFilters = {
            phase: 'all',
            search: ''
        };
        let scrumbanExpanded = false;

        function renderScrumban() {
            const board = document.getElementById('scrumbanBoard');
            let allTasks = getAllTasks();
            
            // Aplicar filtros
            if (scrumbanFilters.phase !== 'all') {
                allTasks = allTasks.filter(task => task.phaseKey === scrumbanFilters.phase);
            }
            
            if (scrumbanFilters.search) {
                const searchLower = scrumbanFilters.search.toLowerCase();
                allTasks = allTasks.filter(task => 
                    task.title.toLowerCase().includes(searchLower) ||
                    task.responsible.toLowerCase().includes(searchLower)
                );
            }
            
            const columns = {
                'nao-iniciada': { title: '📝 Não Iniciada', icon: '📝', tasks: [] },
                'em-andamento': { title: '🔄 Em Andamento', icon: '🔄', tasks: [] },
                'em-revisao': { title: '🔍 Em Revisão', icon: '🔍', tasks: [] },
                'concluida': { title: '✅ Concluída', icon: '✅', tasks: [] }
            };
            
            // Agrupar tarefas por status
            allTasks.forEach(task => {
                if (columns[task.status]) {
                    // Encontrar fase da tarefa
                    let phaseName = '';
                    let phaseIcon = '';
                    Object.keys(phases).forEach(phaseKey => {
                        if (phases[phaseKey].tasks.some(t => t.id === task.id)) {
                            phaseName = phases[phaseKey].name;
                            phaseIcon = phases[phaseKey].icon;
                            task.phaseKey = phaseKey;
                        }
                    });
                    task.phaseName = phaseName;
                    task.phaseIcon = phaseIcon;
                    columns[task.status].tasks.push(task);
                }
            });
            
            board.innerHTML = Object.keys(columns).map(status => {
                const column = columns[status];
                return `
                    <div class="scrumban-column ${status}" data-status="${status}">
                        <div class="scrumban-column-header">
                            <div class="scrumban-column-title">
                                ${column.icon} ${column.title}
                            </div>
                            <div class="scrumban-column-count">${column.tasks.length}</div>
                        </div>
                        <div class="scrumban-cards" data-status="${status}">
                            ${column.tasks.length > 0 ? column.tasks.map(task => `
                                <div class="scrumban-card" 
                                     draggable="true" 
                                     data-task-id="${task.id}"
                                     data-phase-key="${task.phaseKey}"
                                     ondragstart="handleDragStart(event)"
                                     ondragend="handleDragEnd(event)">
                                    <div class="scrumban-card-title">${task.title}</div>
                                    <div class="scrumban-card-meta">
                                        <span class="scrumban-card-phase">${task.phaseIcon} ${task.phaseName}</span>
                                        <span class="scrumban-card-responsible">👤 ${task.responsible}</span>
                                    </div>
                                </div>
                            `).join('') : '<div class="scrumban-empty">Nenhuma tarefa</div>'}
                        </div>
                    </div>
                `;
            }).join('');
            
            // Adicionar event listeners para drop
            document.querySelectorAll('.scrumban-cards').forEach(column => {
                column.addEventListener('dragover', handleDragOver);
                column.addEventListener('drop', handleDrop);
                column.addEventListener('dragleave', handleDragLeave);
            });
        }

        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.innerHTML);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            e.currentTarget.style.background = 'rgba(54, 121, 98, 0.1)';
            return false;
        }

        function handleDragLeave(e) {
            e.currentTarget.style.background = '';
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            e.currentTarget.style.background = '';
            
            const newStatus = e.currentTarget.dataset.status;
            const taskId = parseInt(draggedElement.dataset.taskId);
            const phaseKey = draggedElement.dataset.phaseKey;
            
            // Atualizar status da tarefa
            const task = phases[phaseKey].tasks.find(t => t.id === taskId);
            if (task) {
                task.status = newStatus;
                if (newStatus === 'concluida') {
                    task.completed = true;
                } else {
                    task.completed = false;
                }
                saveData();
                renderScrumban();
                renderPhases();
                updateStats();
            }
            
            return false;
        }

        // Filtrar Scrumban
        function filterScrumban() {
            scrumbanFilters.phase = document.getElementById('scrumbanPhaseFilter').value;
            scrumbanFilters.search = document.getElementById('scrumbanSearchInput').value;
            renderScrumban();
        }

        // Expandir/Recolher Scrumban
        function toggleScrumbanExpand() {
            scrumbanExpanded = !scrumbanExpanded;
            const board = document.getElementById('scrumbanBoard');
            const icon = document.getElementById('scrumbanExpandIcon');
            const text = document.getElementById('scrumbanExpandText');
            
            if (scrumbanExpanded) {
                board.classList.add('expanded');
                icon.textContent = '⬆️';
                text.textContent = 'Recolher';
            } else {
                board.classList.remove('expanded');
                icon.textContent = '⬇️';
                text.textContent = 'Expandir';
            }
        }

        // Funções do calendário melhorado
        let modalCurrentMonth = new Date();
        let selectedDate = null;

        function openCalendarModal() {
            const modal = document.getElementById('calendarModal');
            modal.classList.add('active');
            modalCurrentMonth = new Date(currentMonth);
            renderModalCalendar();
        }

        function closeCalendarModal() {
            const modal = document.getElementById('calendarModal');
            modal.classList.remove('active');
        }

        function changeModalMonth(direction) {
            modalCurrentMonth.setMonth(modalCurrentMonth.getMonth() + direction);
            renderModalCalendar();
        }

        function renderModalCalendar() {
            const grid = document.getElementById('modalCalendarGrid');
            const monthYear = document.getElementById('modalCurrentMonth');
            
            const year = modalCurrentMonth.getFullYear();
            const month = modalCurrentMonth.getMonth();
            
            const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                               'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            monthYear.textContent = `${monthNames[month]} ${year}`;
            
            grid.innerHTML = '';
            
            // Dias da semana
            const dayHeaders = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            const allTasks = getAllTasks();
            
            // Dias do mês anterior
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = document.createElement('div');
                day.className = 'calendar-day other-month';
                day.textContent = daysInPrevMonth - i;
                grid.appendChild(day);
            }
            
            // Dias do mês atual
            const today = new Date();
            for (let i = 1; i <= daysInMonth; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.textContent = i;
                
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                
                if (today.getDate() === i && today.getMonth() === month && today.getFullYear() === year) {
                    day.classList.add('today');
                }
                
                const tasksForDay = allTasks.filter(t => 
                    t.startDate === dateStr || t.endDate === dateStr
                );
                
                const eventsForDay = events.filter(e => e.date === dateStr);
                
                if (tasksForDay.length > 0 || eventsForDay.length > 0) {
                    day.classList.add('has-tasks');
                    const indicator = document.createElement('div');
                    indicator.className = 'calendar-day-indicator';
                    for (let j = 0; j < Math.min(tasksForDay.length + eventsForDay.length, 3); j++) {
                        const dot = document.createElement('div');
                        dot.className = 'calendar-day-dot';
                        indicator.appendChild(dot);
                    }
                    day.appendChild(indicator);
                }
                
                day.onclick = () => showTasksForDate(dateStr, i, month, year);
                
                grid.appendChild(day);
            }
            
            // Completar grade
            const totalCells = grid.children.length - 7;
            const remainingCells = 42 - totalCells - 7;
            for (let i = 1; i <= remainingCells; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day other-month';
                day.textContent = i;
                grid.appendChild(day);
            }
        }

        function showTasksForDate(dateStr, day, month, year) {
            selectedDate = dateStr;
            const allTasks = getAllTasks();
            const tasksForDay = allTasks.filter(t => 
                t.startDate === dateStr || t.endDate === dateStr
            );
            const eventsForDay = events.filter(e => e.date === dateStr);
            
            const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                               'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            document.getElementById('selectedDateTitle').textContent = 
                `📅 ${day} de ${monthNames[month]} de ${year}`;
            
            const tasksList = document.getElementById('modalTasksList');
            
            if (tasksForDay.length === 0 && eventsForDay.length === 0) {
                tasksList.innerHTML = '<p style="text-align: center; color: #adb5bd; padding: 40px 20px;">Nenhuma tarefa ou evento nesta data</p>';
                return;
            }
            
            let html = '';
            
            if (eventsForDay.length > 0) {
                html += '<h4 style="color: #367962; margin-bottom: 10px; font-size: 14px;">📌 EVENTOS</h4>';
                eventsForDay.forEach(event => {
                    html += `
                        <div class="calendar-modal-task-item" style="border-left-color: #F5C745;">
                            <div class="calendar-modal-task-title">${event.title}</div>
                        </div>
                    `;
                });
            }
            
            if (tasksForDay.length > 0) {
                html += '<h4 style="color: #367962; margin: 15px 0 10px 0; font-size: 14px;">✅ TAREFAS</h4>';
                tasksForDay.forEach(task => {
                    let phaseName = '';
                    Object.keys(phases).forEach(phaseKey => {
                        if (phases[phaseKey].tasks.some(t => t.id === task.id)) {
                            phaseName = phases[phaseKey].name;
                        }
                    });
                    
                    const isStart = task.startDate === dateStr;
                    const isEnd = task.endDate === dateStr;
                    const dateLabel = isStart && isEnd ? 'Início e Término' : isStart ? 'Início' : 'Término';
                    
                    html += `
                        <div class="calendar-modal-task-item">
                            <div class="calendar-modal-task-title">${task.title}</div>
                            <div class="calendar-modal-task-meta">
                                📂 ${phaseName} • ${dateLabel} • 👤 ${task.responsible}
                            </div>
                        </div>
                    `;
                });
            }
            
            tasksList.innerHTML = html;
        }

        // Renderizar áreas de conhecimento
        let expandedKnowledgeAreas = {};

        function renderKnowledgeAreas() {
            const container = document.getElementById('knowledgeAreasList');
            
            container.innerHTML = Object.keys(knowledgeAreas).map(areaKey => {
                const area = knowledgeAreas[areaKey];
                const isExpanded = expandedKnowledgeAreas[areaKey];
                
                let attachmentsHTML = '';
                if (area.attachments && area.attachments.length > 0) {
                    attachmentsHTML = area.attachments.map((att, index) => `
                        <div class="knowledge-area-attachment-item">
                            <div class="knowledge-area-attachment-info">
                                <div class="knowledge-area-attachment-icon">${getFileIcon(att.name)}</div>
                                <div class="knowledge-area-attachment-details">
                                    <div class="knowledge-area-attachment-name">${att.name}</div>
                                    <div class="knowledge-area-attachment-meta">${formatFileSize(att.size)} • ${new Date(att.date).toLocaleDateString('pt-BR')}</div>
                                </div>
                            </div>
                            <div class="knowledge-area-attachment-actions">
                                <button class="knowledge-area-attachment-btn knowledge-area-download-btn" 
                                        onclick="downloadKnowledgeAttachment('${areaKey}', ${index})">
                                    ⬇️
                                </button>
                                <button class="knowledge-area-attachment-btn knowledge-area-delete-btn" 
                                        onclick="deleteKnowledgeAttachment('${areaKey}', ${index})">
                                    🗑️
                                </button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    attachmentsHTML = '<p style="text-align: center; color: #adb5bd; font-size: 13px; padding: 15px;">Nenhum documento anexado</p>';
                }
                
                // Conteúdo especial para Partes Interessadas (Stakeholders)
                let stakeholdersContent = '';
                if (areaKey === 'partes_interessadas') {
                    const stakeholdersListHTML = stakeholders.length > 0 ? stakeholders.map(sh => `
                        <div class="stakeholder-item">
                            <div class="stakeholder-avatar">${sh.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase()}</div>
                            <div class="stakeholder-info">
                                <input type="text" class="stakeholder-name-input" value="${sh.name}" 
                                       onblur="updateStakeholder(${sh.id}, 'name', this.value)" 
                                       placeholder="Nome">
                                <input type="text" class="stakeholder-role-input" value="${sh.role}" 
                                       onblur="updateStakeholder(${sh.id}, 'role', this.value)" 
                                       placeholder="Cargo/Função">
                            </div>
                            <div class="stakeholder-level">
                                <select class="stakeholder-level-select" 
                                        onchange="updateStakeholder(${sh.id}, 'level', this.value)">
                                    <option value="Patrocinador" ${sh.level === 'Patrocinador' ? 'selected' : ''}>Patrocinador</option>
                                    <option value="Gerente de Projeto" ${sh.level === 'Gerente de Projeto' ? 'selected' : ''}>Gerente de Projeto</option>
                                    <option value="Equipe" ${sh.level === 'Equipe' ? 'selected' : ''}>Equipe</option>
                                    <option value="Interessado" ${sh.level === 'Interessado' ? 'selected' : ''}>Interessado</option>
                                </select>
                            </div>
                            <button class="stakeholder-delete-btn" onclick="deleteStakeholder(${sh.id})">🗑️</button>
                        </div>
                    `).join('') : '<p class="empty-stakeholders-text" style="text-align: center; color: #adb5bd; padding: 20px;">Nenhum stakeholder cadastrado. Clique em "Adicionar Stakeholder" para começar.</p>';
                    
                    stakeholdersContent = `
                        <div class="knowledge-area-field" style="border-bottom: 2px solid #e9ecef; padding-bottom: 20px; margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <label class="knowledge-area-label" style="margin-bottom: 0;">👥 Gerenciamento de Stakeholders</label>
                                <button class="btn btn-primary" onclick="addStakeholder()" style="padding: 8px 16px; font-size: 13px;">
                                    ➕ Adicionar Stakeholder
                                </button>
                            </div>
                            <div class="stakeholders-hint" style="background: #fff3cd; padding: 12px 15px; border-radius: 6px; font-size: 13px; color: #664d03; margin-bottom: 15px;">
                                💡 Identifique e gerencie as partes interessadas do projeto. Stakeholders são pessoas ou organizações que podem afetar ou serem afetadas pelo projeto.
                            </div>
                            <div class="stakeholders-list">
                                ${stakeholdersListHTML}
                            </div>
                        </div>
                    `;
                }
                
                return `
                    <div class="knowledge-area-card">
                        <div class="knowledge-area-header" onclick="openKnowledgeModal('${areaKey}')">
                            <div class="knowledge-area-icon">${area.icon}</div>
                            <div class="knowledge-area-title-section">
                                <div class="knowledge-area-name">${area.name}</div>
                                <div class="knowledge-area-desc">${area.description}</div>
                            </div>
                            <div class="knowledge-area-toggle" style="font-size: 24px;">🔍</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleKnowledgeArea(areaKey) {
            expandedKnowledgeAreas[areaKey] = !expandedKnowledgeAreas[areaKey];
            renderKnowledgeAreas();
        }

        // Abrir modal de área de conhecimento
        let currentKnowledgeArea = null;

        function openKnowledgeModal(areaKey) {
            currentKnowledgeArea = areaKey;
            const area = knowledgeAreas[areaKey];
            
            document.getElementById('modalAreaIcon').textContent = area.icon;
            document.getElementById('modalAreaName').textContent = area.name;
            document.getElementById('modalAreaDescription').textContent = area.description;
            
            // Renderizar conteúdo específico da área
            renderKnowledgeModalContent(areaKey);
            
            document.getElementById('knowledgeModal').classList.add('active');
        }

        function closeKnowledgeModal() {
            document.getElementById('knowledgeModal').classList.remove('active');
            currentKnowledgeArea = null;
        }

        // Renderizar conteúdo específico para cada área
        function renderKnowledgeModalContent(areaKey) {
            const container = document.getElementById('modalAreaContent');
            const area = knowledgeAreas[areaKey];
            
            // Inicializar dados específicos se não existirem
            if (!area.specificData) {
                area.specificData = {};
            }
            
            let content = '';
            
            // Conteúdo específico para cada área
            switch(areaKey) {
                case 'riscos':
                    content = renderRiskManagementContent(area);
                    break;
                case 'escopo':
                    content = renderScopeContent(area);
                    break;
                case 'cronograma':
                    content = renderScheduleContent(area);
                    break;
                case 'custos':
                    content = renderCostContent(area);
                    break;
                case 'qualidade':
                    content = renderQualityContent(area);
                    break;
                case 'recursos':
                    content = renderResourceContent(area);
                    break;
                case 'comunicacao':
                    content = renderCommunicationContent(area);
                    break;
                case 'aquisicoes':
                    content = renderProcurementContent(area);
                    break;
                case 'partes_interessadas':
                    content = renderStakeholderContent(area);
                    break;
                case 'integracao':
                    content = renderIntegrationContent(area);
                    break;
                default:
                    content = renderDefaultContent(area);
            }
            
            container.innerHTML = content;
        }

        // ÁREA DE RISCOS - Matriz de Risco Completa
        function renderRiskManagementContent(area) {
            if (!area.specificData.risks) area.specificData.risks = [];
            
            return `
                <div class="knowledge-section">
                    <div class="knowledge-section-title">📋 Identificação de Riscos</div>
                    <div class="knowledge-help-box">
                        <strong>Como identificar riscos:</strong><br>
                        • Liste eventos incertos que podem impactar o projeto<br>
                        • Considere riscos técnicos, externos, organizacionais e de gerenciamento<br>
                        • Envolva a equipe e stakeholders na identificação
                    </div>
                    
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">⚠️ Descrição do Risco</label>
                            <input type="text" class="knowledge-form-input" id="riskDescription" 
                                   placeholder="Ex: Atraso na entrega de equipamentos">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📂 Categoria</label>
                            <select class="knowledge-form-select" id="riskCategory">
                                <option value="Técnico">Técnico</option>
                                <option value="Externo">Externo</option>
                                <option value="Organizacional">Organizacional</option>
                                <option value="Gerenciamento">Gerenciamento</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="knowledge-add-btn" onclick="addRiskToMatrix()">
                        ➕ Adicionar à Matriz de Riscos
                    </button>
                </div>

                <div class="knowledge-section">
                    <div class="knowledge-section-title">📊 Matriz de Probabilidade x Impacto</div>
                    <div class="knowledge-help-box">
                        <strong>Como usar:</strong> Clique em uma célula para classificar o risco. 
                        Probabilidade (vertical) x Impacto (horizontal) = Nível de Risco
                    </div>
                    
                    <div class="risk-matrix">
                        <div class="risk-matrix-cell"></div>
                        <div class="risk-matrix-cell risk-matrix-header">Muito Baixo</div>
                        <div class="risk-matrix-cell risk-matrix-header">Baixo</div>
                        <div class="risk-matrix-cell risk-matrix-header">Médio</div>
                        <div class="risk-matrix-cell risk-matrix-header">Alto</div>
                        <div class="risk-matrix-cell risk-matrix-header">Muito Alto</div>
                        
                        ${[5,4,3,2,1].map(prob => `
                            <div class="risk-matrix-cell risk-matrix-label">${
                                prob === 5 ? 'Muito Alta' : 
                                prob === 4 ? 'Alta' : 
                                prob === 3 ? 'Média' : 
                                prob === 2 ? 'Baixa' : 'Muito Baixa'
                            }</div>
                            ${[1,2,3,4,5].map(impact => {
                                const level = prob * impact;
                                let className = '';
                                if (level <= 5) className = 'risk-level-very-low';
                                else if (level <= 10) className = 'risk-level-low';
                                else if (level <= 15) className = 'risk-level-medium';
                                else if (level <= 20) className = 'risk-level-high';
                                else className = 'risk-level-very-high';
                                return `<div class="risk-matrix-cell ${className}" 
                                            onclick="selectRiskLevel(${prob}, ${impact})">${level}</div>`;
                            }).join('')}
                        `).join('')}
                    </div>
                </div>

                <div class="knowledge-section">
                    <div class="knowledge-section-title">📋 Riscos Identificados</div>
                    <div class="risk-list" id="risksList">
                        ${area.specificData.risks.length > 0 ? 
                            area.specificData.risks.map((risk, index) => `
                                <div class="risk-item">
                                    <div class="risk-item-info">
                                        <h4>${risk.description}</h4>
                                        <p>Categoria: ${risk.category} | Prob: ${risk.probability}/5 | Impacto: ${risk.impact}/5</p>
                                    </div>
                                    <div class="risk-badge ${getRiskLevelClass(risk.probability * risk.impact)}">
                                        ${getRiskLevelText(risk.probability * risk.impact)}
                                    </div>
                                    <button class="knowledge-delete-btn" onclick="deleteRisk(${index})">🗑️</button>
                                </div>
                            `).join('') :
                            '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhum risco identificado ainda</p>'
                        }
                    </div>
                </div>

                ${renderNotesAndAttachments(area, 'riscos')}
            `;
        }

        let tempRiskData = { probability: 0, impact: 0 };

        function selectRiskLevel(prob, impact) {
            tempRiskData.probability = prob;
            tempRiskData.impact = impact;
            alert(`Risco classificado: Probabilidade ${prob}/5, Impacto ${impact}/5`);
        }

        function addRiskToMatrix() {
            const description = document.getElementById('riskDescription').value;
            const category = document.getElementById('riskCategory').value;
            
            if (!description) {
                alert('Por favor, descreva o risco');
                return;
            }
            
            if (tempRiskData.probability === 0 || tempRiskData.impact === 0) {
                alert('Por favor, selecione uma célula na matriz para classificar o risco');
                return;
            }
            
            const area = knowledgeAreas['riscos'];
            if (!area.specificData.risks) area.specificData.risks = [];
            
            area.specificData.risks.push({
                description,
                category,
                probability: tempRiskData.probability,
                impact: tempRiskData.impact,
                level: tempRiskData.probability * tempRiskData.impact
            });
            
            saveData();
            renderKnowledgeModalContent('riscos');
            
            // Limpar
            document.getElementById('riskDescription').value = '';
            tempRiskData = { probability: 0, impact: 0 };
        }

        function deleteRisk(index) {
            if (confirm('Deseja excluir este risco?')) {
                knowledgeAreas['riscos'].specificData.risks.splice(index, 1);
                saveData();
                renderKnowledgeModalContent('riscos');
            }
        }

        function getRiskLevelClass(level) {
            if (level <= 5) return 'risk-level-very-low';
            if (level <= 10) return 'risk-level-low';
            if (level <= 15) return 'risk-level-medium';
            if (level <= 20) return 'risk-level-high';
            return 'risk-level-very-high';
        }

        function getRiskLevelText(level) {
            if (level <= 5) return 'Muito Baixo';
            if (level <= 10) return 'Baixo';
            if (level <= 15) return 'Médio';
            if (level <= 20) return 'Alto';
            return 'Muito Alto';
        }

        // Template padrão de notas e anexos
        function renderNotesAndAttachments(area, areaKey) {
            const attachmentsHTML = area.attachments && area.attachments.length > 0 ?
                area.attachments.map((att, index) => `
                    <div class="knowledge-area-attachment-item">
                        <div class="knowledge-area-attachment-info">
                            <div class="knowledge-area-attachment-icon">${getFileIcon(att.name)}</div>
                            <div class="knowledge-area-attachment-details">
                                <div class="knowledge-area-attachment-name">${att.name}</div>
                                <div class="knowledge-area-attachment-meta">${formatFileSize(att.size)}</div>
                            </div>
                        </div>
                        <div class="knowledge-area-attachment-actions">
                            <button class="knowledge-area-attachment-btn knowledge-area-download-btn" 
                                    onclick="downloadKnowledgeAttachment('${areaKey}', ${index})">⬇️</button>
                            <button class="knowledge-area-attachment-btn knowledge-area-delete-btn" 
                                    onclick="deleteKnowledgeAttachment('${areaKey}', ${index})">🗑️</button>
                        </div>
                    </div>
                `).join('') :
                '<p style="text-align: center; color: #adb5bd; padding: 15px;">Nenhum documento anexado</p>';
            
            return `
                <div class="knowledge-section">
                    <div class="knowledge-section-title">📝 Notas Gerais</div>
                    <div class="knowledge-help-box" style="background: #fff3cd; border-left-color: #ffc107;">
                        💡 <strong>Espaço para anotações livres:</strong> Use este campo para documentar informações importantes, 
                        observações, decisões, lições aprendidas ou qualquer outra informação relevante sobre esta área de conhecimento.
                    </div>
                    <textarea class="knowledge-form-textarea" 
                              style="min-height: 200px; font-size: 14px;"
                              onblur="updateKnowledgeArea('${areaKey}', this.value)"
                              placeholder="Adicione anotações gerais, observações importantes, decisões tomadas, lições aprendidas...">${area.notes || ''}</textarea>
                </div>
                
                <div class="knowledge-section">
                    <div class="knowledge-section-title">📎 Documentos Anexados (${area.attachments ? area.attachments.length : 0})</div>
                    <div class="knowledge-help-box" style="background: #e7f5ff; border-left-color: #0d6efd;">
                        📌 <strong>Anexe documentos relevantes:</strong> Contratos, planilhas, apresentações, imagens, PDFs, 
                        ou qualquer arquivo que complemente as informações desta área.
                    </div>
                    <button class="knowledge-add-btn" onclick="uploadKnowledgeAttachment('${areaKey}')">
                        ➕ Anexar Documento
                    </button>
                    <div style="margin-top: 15px;">
                        ${attachmentsHTML}
                    </div>
                </div>
            `;
        }

        // Renderizar conteúdo padrão para áreas ainda não implementadas
        function renderDefaultContent(area) {
            return `
                <div class="knowledge-help-box">
                    💡 Esta área ainda está em desenvolvimento. Em breve terá ferramentas específicas!
                </div>
                ${renderNotesAndAttachments(area, currentKnowledgeArea)}
            `;
        }

        // Implementações simplificadas para outras áreas (será expandido)
        function renderScopeContent(area) {
            if (!area.specificData.wbs) area.specificData.wbs = [];
            if (!area.specificData.requirements) area.specificData.requirements = [];
            
            return `
                <div class="knowledge-section">
                    <div class="knowledge-section-title">📋 Declaração de Escopo</div>
                    <div class="knowledge-help-box">
                        <strong>Escopo do Projeto:</strong> Define claramente o que está incluído e excluído do projeto.
                        Documente objetivos, entregas principais, limites e critérios de aceitação.
                    </div>
                    
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field" style="grid-column: 1 / -1;">
                            <label class="knowledge-form-label">🎯 Objetivo do Projeto</label>
                            <textarea class="knowledge-form-textarea" id="scopeObjective"
                                      placeholder="Descreva o objetivo principal do projeto...">${area.specificData.objective || ''}</textarea>
                        </div>
                        <div class="knowledge-form-field" style="grid-column: 1 / -1;">
                            <label class="knowledge-form-label">📦 Entregas Principais</label>
                            <textarea class="knowledge-form-textarea" id="scopeDeliverables"
                                      placeholder="Liste as principais entregas do projeto...">${area.specificData.deliverables || ''}</textarea>
                        </div>
                        <div class="knowledge-form-field" style="grid-column: 1 / -1;">
                            <label class="knowledge-form-label">🚫 Exclusões (Fora do Escopo)</label>
                            <textarea class="knowledge-form-textarea" id="scopeExclusions"
                                      placeholder="O que NÃO está incluído no projeto...">${area.specificData.exclusions || ''}</textarea>
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="saveScopeDeclaration()">💾 Salvar Declaração de Escopo</button>
                </div>

                <div class="knowledge-section">
                    <div class="knowledge-section-title">🌳 EAP - Estrutura Analítica do Projeto (WBS)</div>
                    <div class="knowledge-help-box">
                        <strong>WBS (Work Breakdown Structure):</strong> Decomposição hierárquica do trabalho.<br>
                        • Nível 1: Grandes pacotes de trabalho<br>
                        • Nível 2: Subpacotes<br>
                        • Nível 3: Atividades específicas
                    </div>
                    
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📝 Nome do Item</label>
                            <input type="text" class="knowledge-form-input" id="wbsName" 
                                   placeholder="Ex: Infraestrutura de TI">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📊 Nível Hierárquico</label>
                            <select class="knowledge-form-select" id="wbsLevel">
                                <option value="1">Nível 1 - Pacote Principal</option>
                                <option value="2">Nível 2 - Subpacote</option>
                                <option value="3">Nível 3 - Atividade</option>
                            </select>
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">👤 Responsável</label>
                            <input type="text" class="knowledge-form-input" id="wbsResponsible" 
                                   placeholder="Nome do responsável">
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="addWBSItem()">➕ Adicionar Item à EAP</button>
                    
                    <div class="wbs-container" style="margin-top: 20px;">
                        ${area.specificData.wbs.length > 0 ? 
                            area.specificData.wbs.map((item, index) => `
                                <div class="wbs-item level-${item.level}">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <strong>${item.name}</strong>
                                            <span style="font-size: 12px; color: #6c757d; margin-left: 10px;">
                                                👤 ${item.responsible}
                                            </span>
                                        </div>
                                        <button class="knowledge-delete-btn" onclick="deleteWBSItem(${index})">🗑️</button>
                                    </div>
                                </div>
                            `).join('') :
                            '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhum item na EAP ainda</p>'
                        }
                    </div>
                </div>

                <div class="knowledge-section">
                    <div class="knowledge-section-title">✅ Requisitos do Projeto</div>
                    <div class="knowledge-help-box">
                        <strong>Requisitos:</strong> Condições ou capacidades que o projeto deve atender.
                    </div>
                    
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📋 Requisito</label>
                            <input type="text" class="knowledge-form-input" id="reqDescription" 
                                   placeholder="Descreva o requisito">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">🏷️ Tipo</label>
                            <select class="knowledge-form-select" id="reqType">
                                <option value="Funcional">Funcional</option>
                                <option value="Não-Funcional">Não-Funcional</option>
                                <option value="Técnico">Técnico</option>
                                <option value="Negócio">Negócio</option>
                            </select>
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">⚡ Prioridade</label>
                            <select class="knowledge-form-select" id="reqPriority">
                                <option value="Alta">Alta</option>
                                <option value="Média">Média</option>
                                <option value="Baixa">Baixa</option>
                            </select>
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="addRequirement()">➕ Adicionar Requisito</button>
                    
                    <div class="risk-list" style="margin-top: 20px;">
                        ${area.specificData.requirements.length > 0 ? 
                            area.specificData.requirements.map((req, index) => `
                                <div class="risk-item">
                                    <div class="risk-item-info">
                                        <h4>${req.description}</h4>
                                        <p>Tipo: ${req.type} | Prioridade: ${req.priority}</p>
                                    </div>
                                    <div class="risk-badge ${req.priority === 'Alta' ? 'risk-level-very-high' : req.priority === 'Média' ? 'risk-level-medium' : 'risk-level-low'}">
                                        ${req.priority}
                                    </div>
                                    <button class="knowledge-delete-btn" onclick="deleteRequirement(${index})">🗑️</button>
                                </div>
                            `).join('') :
                            '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhum requisito cadastrado</p>'
                        }
                    </div>
                </div>

                ${renderNotesAndAttachments(area, 'escopo')}
            `;
        }

        function saveScopeDeclaration() {
            const area = knowledgeAreas['escopo'];
            area.specificData.objective = document.getElementById('scopeObjective').value;
            area.specificData.deliverables = document.getElementById('scopeDeliverables').value;
            area.specificData.exclusions = document.getElementById('scopeExclusions').value;
            saveData();
            alert('Declaração de Escopo salva com sucesso!');
        }

        function addWBSItem() {
            const name = document.getElementById('wbsName').value;
            const level = document.getElementById('wbsLevel').value;
            const responsible = document.getElementById('wbsResponsible').value;
            
            if (!name || !responsible) {
                alert('Preencha todos os campos');
                return;
            }
            
            const area = knowledgeAreas['escopo'];
            if (!area.specificData.wbs) area.specificData.wbs = [];
            
            area.specificData.wbs.push({ name, level: parseInt(level), responsible });
            saveData();
            renderKnowledgeModalContent('escopo');
        }

        function deleteWBSItem(index) {
            if (confirm('Excluir este item da EAP?')) {
                knowledgeAreas['escopo'].specificData.wbs.splice(index, 1);
                saveData();
                renderKnowledgeModalContent('escopo');
            }
        }

        function addRequirement() {
            const description = document.getElementById('reqDescription').value;
            const type = document.getElementById('reqType').value;
            const priority = document.getElementById('reqPriority').value;
            
            if (!description) {
                alert('Descreva o requisito');
                return;
            }
            
            const area = knowledgeAreas['escopo'];
            if (!area.specificData.requirements) area.specificData.requirements = [];
            
            area.specificData.requirements.push({ description, type, priority });
            saveData();
            renderKnowledgeModalContent('escopo');
        }

        function deleteRequirement(index) {
            if (confirm('Excluir este requisito?')) {
                knowledgeAreas['escopo'].specificData.requirements.splice(index, 1);
                saveData();
                renderKnowledgeModalContent('escopo');
            }
        }

        function renderScheduleContent(area) {
            if (!area.specificData.milestones) area.specificData.milestones = [];
            if (!area.specificData.dependencies) area.specificData.dependencies = [];
            
            return `
                <div class="knowledge-section">
                    <div class="knowledge-section-title">📅 Marcos do Projeto (Milestones)</div>
                    <div class="knowledge-help-box">
                        <strong>Marcos (Milestones):</strong> Pontos significativos ou eventos no cronograma do projeto.
                        Representam conclusões importantes, entregas-chave ou pontos de decisão.
                    </div>
                    
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">🎯 Nome do Marco</label>
                            <input type="text" class="knowledge-form-input" id="milestoneName" 
                                   placeholder="Ex: Aprovação do Design">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📅 Data Prevista</label>
                            <input type="date" class="knowledge-form-input" id="milestoneDate">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📂 Fase Relacionada</label>
                            <select class="knowledge-form-select" id="milestonePhase">
                                <option value="Iniciação">Iniciação</option>
                                <option value="Planejamento">Planejamento</option>
                                <option value="Execução">Execução</option>
                                <option value="Monitoramento">Monitoramento</option>
                                <option value="Encerramento">Encerramento</option>
                            </select>
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="addMilestone()">➕ Adicionar Marco</button>
                    
                    <div class="risk-list" style="margin-top: 20px;">
                        ${area.specificData.milestones.length > 0 ? 
                            area.specificData.milestones.sort((a, b) => new Date(a.date) - new Date(b.date)).map((milestone, index) => `
                                <div class="risk-item">
                                    <div class="risk-item-info">
                                        <h4>🎯 ${milestone.name}</h4>
                                        <p>📅 ${new Date(milestone.date).toLocaleDateString('pt-BR')} | 📂 ${milestone.phase}</p>
                                    </div>
                                    <button class="knowledge-delete-btn" onclick="deleteMilestone(${index})">🗑️</button>
                                </div>
                            `).join('') :
                            '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhum marco definido</p>'
                        }
                    </div>
                </div>

                <div class="knowledge-section">
                    <div class="knowledge-section-title">🔗 Dependências entre Tarefas</div>
                    <div class="knowledge-help-box">
                        <strong>Dependências:</strong> Relacionamentos lógicos entre tarefas.<br>
                        • <strong>Término-Início (TI):</strong> Tarefa B só começa quando A terminar<br>
                        • <strong>Início-Início (II):</strong> Tarefa B começa quando A começar<br>
                        • <strong>Término-Término (TT):</strong> Tarefa B termina quando A terminar
                    </div>
                    
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📋 Tarefa Predecessora</label>
                            <input type="text" class="knowledge-form-input" id="depPredecessor" 
                                   placeholder="Tarefa que vem antes">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📋 Tarefa Sucessora</label>
                            <input type="text" class="knowledge-form-input" id="depSuccessor" 
                                   placeholder="Tarefa que vem depois">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">🔗 Tipo de Dependência</label>
                            <select class="knowledge-form-select" id="depType">
                                <option value="TI">Término-Início (TI)</option>
                                <option value="II">Início-Início (II)</option>
                                <option value="TT">Término-Término (TT)</option>
                            </select>
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="addDependency()">➕ Adicionar Dependência</button>
                    
                    <div class="risk-list" style="margin-top: 20px;">
                        ${area.specificData.dependencies.length > 0 ? 
                            area.specificData.dependencies.map((dep, index) => `
                                <div class="risk-item">
                                    <div class="risk-item-info">
                                        <h4>${dep.predecessor} → ${dep.successor}</h4>
                                        <p>Tipo: ${dep.type}</p>
                                    </div>
                                    <button class="knowledge-delete-btn" onclick="deleteDependency(${index})">🗑️</button>
                                </div>
                            `).join('') :
                            '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhuma dependência definida</p>'
                        }
                    </div>
                </div>

                <div class="knowledge-section">
                    <div class="knowledge-section-title">⏱️ Estimativas de Tempo</div>
                    <div class="knowledge-help-box">
                        <strong>Técnica PERT (3 pontos):</strong> Estimativa mais realista considerando otimista, pessimista e mais provável.<br>
                        <strong>Fórmula:</strong> Tempo Esperado = (Otimista + 4×Mais Provável + Pessimista) / 6
                    </div>
                    
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">😊 Tempo Otimista (dias)</label>
                            <input type="number" class="knowledge-form-input" id="timeOptimistic" 
                                   placeholder="Melhor cenário" min="1">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📊 Tempo Mais Provável (dias)</label>
                            <input type="number" class="knowledge-form-input" id="timeMostLikely" 
                                   placeholder="Cenário realista" min="1">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">😰 Tempo Pessimista (dias)</label>
                            <input type="number" class="knowledge-form-input" id="timePessimistic" 
                                   placeholder="Pior cenário" min="1">
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="calculatePERT()">🧮 Calcular Tempo Esperado (PERT)</button>
                    
                    <div id="pertResult" style="margin-top: 15px;"></div>
                </div>

                ${renderNotesAndAttachments(area, 'cronograma')}
            `;
        }

        function addMilestone() {
            const name = document.getElementById('milestoneName').value;
            const date = document.getElementById('milestoneDate').value;
            const phase = document.getElementById('milestonePhase').value;
            
            if (!name || !date) {
                alert('Preencha nome e data do marco');
                return;
            }
            
            const area = knowledgeAreas['cronograma'];
            if (!area.specificData.milestones) area.specificData.milestones = [];
            
            area.specificData.milestones.push({ name, date, phase });
            saveData();
            renderKnowledgeModalContent('cronograma');
        }

        function deleteMilestone(index) {
            if (confirm('Excluir este marco?')) {
                knowledgeAreas['cronograma'].specificData.milestones.splice(index, 1);
                saveData();
                renderKnowledgeModalContent('cronograma');
            }
        }

        function addDependency() {
            const predecessor = document.getElementById('depPredecessor').value;
            const successor = document.getElementById('depSuccessor').value;
            const type = document.getElementById('depType').value;
            
            if (!predecessor || !successor) {
                alert('Preencha as tarefas predecessora e sucessora');
                return;
            }
            
            const area = knowledgeAreas['cronograma'];
            if (!area.specificData.dependencies) area.specificData.dependencies = [];
            
            area.specificData.dependencies.push({ predecessor, successor, type });
            saveData();
            renderKnowledgeModalContent('cronograma');
        }

        function deleteDependency(index) {
            if (confirm('Excluir esta dependência?')) {
                knowledgeAreas['cronograma'].specificData.dependencies.splice(index, 1);
                saveData();
                renderKnowledgeModalContent('cronograma');
            }
        }

        function calculatePERT() {
            const optimistic = parseFloat(document.getElementById('timeOptimistic').value);
            const mostLikely = parseFloat(document.getElementById('timeMostLikely').value);
            const pessimistic = parseFloat(document.getElementById('timePessimistic').value);
            
            if (!optimistic || !mostLikely || !pessimistic) {
                alert('Preencha todos os três tempos');
                return;
            }
            
            const expectedTime = (optimistic + 4 * mostLikely + pessimistic) / 6;
            const standardDeviation = (pessimistic - optimistic) / 6;
            
            document.getElementById('pertResult').innerHTML = `
                <div class="knowledge-help-box" style="background: #d1e7dd; border-left-color: #0f5132;">
                    <strong>📊 Resultado da Análise PERT:</strong><br><br>
                    ⏱️ <strong>Tempo Esperado:</strong> ${expectedTime.toFixed(2)} dias<br>
                    📏 <strong>Desvio Padrão:</strong> ${standardDeviation.toFixed(2)} dias<br>
                    📈 <strong>Intervalo de Confiança (68%):</strong> ${(expectedTime - standardDeviation).toFixed(2)} a ${(expectedTime + standardDeviation).toFixed(2)} dias
                </div>
            `;
        }

        function renderCostContent(area) {
            if (!area.specificData.budget) area.specificData.budget = [];
            if (!area.specificData.expenses) area.specificData.expenses = [];
            
            const totalBudget = area.specificData.budget.reduce((sum, item) => sum + parseFloat(item.value || 0), 0);
            const totalExpenses = area.specificData.expenses.reduce((sum, item) => sum + parseFloat(item.value || 0), 0);
            const remaining = totalBudget - totalExpenses;
            const percentUsed = totalBudget > 0 ? (totalExpenses / totalBudget * 100).toFixed(1) : 0;
            
            return `
                <div class="knowledge-section">
                    <div class="knowledge-section-title">💰 Orçamento do Projeto</div>
                    <div class="knowledge-help-box">
                        <strong>Orçamento:</strong> Planeje os custos por categoria. Monitore gastos vs. planejado.
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                        <div style="background: #e7f5ff; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: #0d6efd;">R$ ${totalBudget.toLocaleString('pt-BR')}</div>
                            <div style="font-size: 12px; color: #6c757d;">Orçamento Total</div>
                        </div>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: #664d03;">R$ ${totalExpenses.toLocaleString('pt-BR')}</div>
                            <div style="font-size: 12px; color: #6c757d;">Gasto Atual (${percentUsed}%)</div>
                        </div>
                        <div style="background: ${remaining >= 0 ? '#d1e7dd' : '#f8d7da'}; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: ${remaining >= 0 ? '#0f5132' : '#842029'};">R$ ${remaining.toLocaleString('pt-BR')}</div>
                            <div style="font-size: 12px; color: #6c757d;">${remaining >= 0 ? 'Disponível' : 'Excedente'}</div>
                        </div>
                    </div>
                    
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📂 Categoria</label>
                            <input type="text" class="knowledge-form-input" id="budgetCategory" 
                                   placeholder="Ex: Equipamentos, RH, Consultoria">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">💵 Valor Orçado (R$)</label>
                            <input type="number" class="knowledge-form-input" id="budgetValue" 
                                   placeholder="0.00" step="0.01" min="0">
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="addBudgetItem()">➕ Adicionar Item ao Orçamento</button>
                    
                    <div class="risk-list" style="margin-top: 20px;">
                        ${area.specificData.budget.map((item, index) => `
                            <div class="risk-item">
                                <div class="risk-item-info">
                                    <h4>${item.category}</h4>
                                    <p>Valor Orçado: R$ ${parseFloat(item.value).toLocaleString('pt-BR')}</p>
                                </div>
                                <button class="knowledge-delete-btn" onclick="deleteBudgetItem(${index})">🗑️</button>
                            </div>
                        `).join('') || '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhum item no orçamento</p>'}
                    </div>
                </div>

                <div class="knowledge-section">
                    <div class="knowledge-section-title">💸 Registro de Despesas</div>
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📋 Descrição</label>
                            <input type="text" class="knowledge-form-input" id="expenseDescription" 
                                   placeholder="Ex: Compra de servidores">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">💵 Valor (R$)</label>
                            <input type="number" class="knowledge-form-input" id="expenseValue" 
                                   placeholder="0.00" step="0.01" min="0">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📅 Data</label>
                            <input type="date" class="knowledge-form-input" id="expenseDate">
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="addExpense()">➕ Registrar Despesa</button>
                    
                    <div class="risk-list" style="margin-top: 20px;">
                        ${area.specificData.expenses.map((item, index) => `
                            <div class="risk-item">
                                <div class="risk-item-info">
                                    <h4>${item.description}</h4>
                                    <p>R$ ${parseFloat(item.value).toLocaleString('pt-BR')} • ${new Date(item.date).toLocaleDateString('pt-BR')}</p>
                                </div>
                                <button class="knowledge-delete-btn" onclick="deleteExpense(${index})">🗑️</button>
                            </div>
                        `).join('') || '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhuma despesa registrada</p>'}
                    </div>
                </div>

                ${renderNotesAndAttachments(area, 'custos')}
            `;
        }

        function addBudgetItem() {
            const category = document.getElementById('budgetCategory').value;
            const value = document.getElementById('budgetValue').value;
            if (!category || !value) { alert('Preencha todos os campos'); return; }
            knowledgeAreas['custos'].specificData.budget.push({ category, value });
            saveData();
            renderKnowledgeModalContent('custos');
        }

        function deleteBudgetItem(index) {
            if (confirm('Excluir item do orçamento?')) {
                knowledgeAreas['custos'].specificData.budget.splice(index, 1);
                saveData();
                renderKnowledgeModalContent('custos');
            }
        }

        function addExpense() {
            const description = document.getElementById('expenseDescription').value;
            const value = document.getElementById('expenseValue').value;
            const date = document.getElementById('expenseDate').value;
            if (!description || !value || !date) { alert('Preencha todos os campos'); return; }
            knowledgeAreas['custos'].specificData.expenses.push({ description, value, date });
            saveData();
            renderKnowledgeModalContent('custos');
        }

        function deleteExpense(index) {
            if (confirm('Excluir despesa?')) {
                knowledgeAreas['custos'].specificData.expenses.splice(index, 1);
                saveData();
                renderKnowledgeModalContent('custos');
            }
        }

        function renderQualityContent(area) {
            if (!area.specificData.metrics) area.specificData.metrics = [];
            if (!area.specificData.checklist) area.specificData.checklist = [];
            
            return `
                <div class="knowledge-section">
                    <div class="knowledge-section-title">⭐ Métricas de Qualidade</div>
                    <div class="knowledge-help-box">
                        <strong>Métricas:</strong> Indicadores mensuráveis para avaliar a qualidade do projeto.
                    </div>
                    
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📊 Nome da Métrica</label>
                            <input type="text" class="knowledge-form-input" id="metricName" 
                                   placeholder="Ex: Taxa de Defeitos">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">🎯 Meta</label>
                            <input type="text" class="knowledge-form-input" id="metricTarget" 
                                   placeholder="Ex: < 2%">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📈 Valor Atual</label>
                            <input type="text" class="knowledge-form-input" id="metricCurrent" 
                                   placeholder="Ex: 1.5%">
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="addMetric()">➕ Adicionar Métrica</button>
                    
                    <div class="risk-list" style="margin-top: 20px;">
                        ${area.specificData.metrics.map((m, i) => `
                            <div class="risk-item">
                                <div class="risk-item-info">
                                    <h4>${m.name}</h4>
                                    <p>Meta: ${m.target} | Atual: ${m.current}</p>
                                </div>
                                <button class="knowledge-delete-btn" onclick="deleteMetric(${i})">🗑️</button>
                            </div>
                        `).join('') || '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhuma métrica definida</p>'}
                    </div>
                </div>

                <div class="knowledge-section">
                    <div class="knowledge-section-title">✅ Checklist de Qualidade</div>
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field" style="grid-column: 1 / -1;">
                            <label class="knowledge-form-label">📋 Item do Checklist</label>
                            <input type="text" class="knowledge-form-input" id="checklistItem" 
                                   placeholder="Ex: Documentação completa e revisada">
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="addChecklistItem()">➕ Adicionar Item</button>
                    
                    <div style="margin-top: 20px;">
                        ${area.specificData.checklist.map((item, i) => `
                            <div style="background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 8px; padding: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; flex: 1;">
                                    <input type="checkbox" ${item.checked ? 'checked' : ''} 
                                           onchange="toggleChecklistItem(${i})"
                                           style="width: 20px; height: 20px; cursor: pointer;">
                                    <span style="font-size: 14px; ${item.checked ? 'text-decoration: line-through; color: #6c757d;' : ''}">${item.text}</span>
                                </label>
                                <button class="knowledge-delete-btn" onclick="deleteChecklistItem(${i})">🗑️</button>
                            </div>
                        `).join('') || '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhum item no checklist</p>'}
                    </div>
                </div>

                ${renderNotesAndAttachments(area, 'qualidade')}
            `;
        }

        function addMetric() {
            const name = document.getElementById('metricName').value;
            const target = document.getElementById('metricTarget').value;
            const current = document.getElementById('metricCurrent').value;
            if (!name || !target) { alert('Preencha nome e meta'); return; }
            knowledgeAreas['qualidade'].specificData.metrics.push({ name, target, current: current || 'N/A' });
            saveData();
            renderKnowledgeModalContent('qualidade');
        }

        function deleteMetric(i) {
            if (confirm('Excluir métrica?')) {
                knowledgeAreas['qualidade'].specificData.metrics.splice(i, 1);
                saveData();
                renderKnowledgeModalContent('qualidade');
            }
        }

        function addChecklistItem() {
            const text = document.getElementById('checklistItem').value;
            if (!text) { alert('Digite o item'); return; }
            knowledgeAreas['qualidade'].specificData.checklist.push({ text, checked: false });
            saveData();
            renderKnowledgeModalContent('qualidade');
        }

        function toggleChecklistItem(i) {
            knowledgeAreas['qualidade'].specificData.checklist[i].checked = !knowledgeAreas['qualidade'].specificData.checklist[i].checked;
            saveData();
            renderKnowledgeModalContent('qualidade');
        }

        function deleteChecklistItem(i) {
            if (confirm('Excluir item?')) {
                knowledgeAreas['qualidade'].specificData.checklist.splice(i, 1);
                saveData();
                renderKnowledgeModalContent('qualidade');
            }
        }

        function renderResourceContent(area) {
            if (!area.specificData.raci) area.specificData.raci = [];
            if (!area.specificData.team) area.specificData.team = [];
            
            return `
                <div class="knowledge-section">
                    <div class="knowledge-section-title">👥 Equipe do Projeto</div>
                    <div class="knowledge-help-box">
                        <strong>Recursos Humanos:</strong> Identifique os membros da equipe e suas atribuições.
                    </div>
                    
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">👤 Nome</label>
                            <input type="text" class="knowledge-form-input" id="teamMemberName">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">💼 Função</label>
                            <input type="text" class="knowledge-form-input" id="teamMemberRole">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">⏱️ Dedicação</label>
                            <select class="knowledge-form-select" id="teamMemberDedication">
                                <option value="100%">100% (Integral)</option>
                                <option value="75%">75%</option>
                                <option value="50%">50% (Meio período)</option>
                                <option value="25%">25%</option>
                            </select>
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="addTeamMember()">➕ Adicionar Membro</button>
                    
                    <div class="risk-list" style="margin-top: 20px;">
                        ${area.specificData.team.map((m, i) => `
                            <div class="risk-item">
                                <div class="risk-item-info">
                                    <h4>👤 ${m.name}</h4>
                                    <p>${m.role} • Dedicação: ${m.dedication}</p>
                                </div>
                                <button class="knowledge-delete-btn" onclick="deleteTeamMember(${i})">🗑️</button>
                            </div>
                        `).join('') || '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhum membro cadastrado</p>'}
                    </div>
                </div>

                <div class="knowledge-section">
                    <div class="knowledge-section-title">📊 Matriz RACI</div>
                    <div class="knowledge-help-box">
                        <strong>RACI:</strong> Define papéis e responsabilidades.<br>
                        • <strong>R (Responsible):</strong> Responsável pela execução<br>
                        • <strong>A (Accountable):</strong> Aprovador final<br>
                        • <strong>C (Consulted):</strong> Consultado<br>
                        • <strong>I (Informed):</strong> Informado
                    </div>
                    
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📋 Atividade</label>
                            <input type="text" class="knowledge-form-input" id="raciActivity">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">👤 Pessoa</label>
                            <input type="text" class="knowledge-form-input" id="raciPerson">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">🏷️ Papel RACI</label>
                            <select class="knowledge-form-select" id="raciRole">
                                <option value="R">R - Responsável</option>
                                <option value="A">A - Aprovador</option>
                                <option value="C">C - Consultado</option>
                                <option value="I">I - Informado</option>
                            </select>
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="addRACIItem()">➕ Adicionar à Matriz RACI</button>
                    
                    <div class="risk-list" style="margin-top: 20px;">
                        ${area.specificData.raci.map((r, i) => `
                            <div class="risk-item">
                                <div class="risk-item-info">
                                    <h4>${r.activity}</h4>
                                    <p>${r.person} - ${r.role}</p>
                                </div>
                                <div class="risk-badge ${r.role === 'R' ? 'risk-level-very-high' : r.role === 'A' ? 'risk-level-high' : r.role === 'C' ? 'risk-level-medium' : 'risk-level-low'}">
                                    ${r.role}
                                </div>
                                <button class="knowledge-delete-btn" onclick="deleteRACIItem(${i})">🗑️</button>
                            </div>
                        `).join('') || '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhum item na matriz RACI</p>'}
                    </div>
                </div>

                ${renderNotesAndAttachments(area, 'recursos')}
            `;
        }

        function addTeamMember() {
            const name = document.getElementById('teamMemberName').value;
            const role = document.getElementById('teamMemberRole').value;
            const dedication = document.getElementById('teamMemberDedication').value;
            if (!name || !role) { alert('Preencha nome e função'); return; }
            knowledgeAreas['recursos'].specificData.team.push({ name, role, dedication });
            saveData();
            renderKnowledgeModalContent('recursos');
        }

        function deleteTeamMember(i) {
            if (confirm('Remover membro?')) {
                knowledgeAreas['recursos'].specificData.team.splice(i, 1);
                saveData();
                renderKnowledgeModalContent('recursos');
            }
        }

        function addRACIItem() {
            const activity = document.getElementById('raciActivity').value;
            const person = document.getElementById('raciPerson').value;
            const role = document.getElementById('raciRole').value;
            if (!activity || !person) { alert('Preencha atividade e pessoa'); return; }
            knowledgeAreas['recursos'].specificData.raci.push({ activity, person, role });
            saveData();
            renderKnowledgeModalContent('recursos');
        }

        function deleteRACIItem(i) {
            if (confirm('Excluir item?')) {
                knowledgeAreas['recursos'].specificData.raci.splice(i, 1);
                saveData();
                renderKnowledgeModalContent('recursos');
            }
        }

        function renderCommunicationContent(area) {
            if (!area.specificData.plan) area.specificData.plan = [];
            if (!area.specificData.meetings) area.specificData.meetings = [];
            
            return `
                <div class="knowledge-section">
                    <div class="knowledge-section-title">📢 Plano de Comunicação</div>
                    <div class="knowledge-help-box">
                        <strong>Plano de Comunicação:</strong> Define o que comunicar, para quem, quando e como.
                    </div>
                    
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📋 Informação</label>
                            <input type="text" class="knowledge-form-input" id="commWhat" 
                                   placeholder="O que será comunicado">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">👥 Para Quem</label>
                            <input type="text" class="knowledge-form-input" id="commWho" 
                                   placeholder="Destinatários">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📅 Quando</label>
                            <select class="knowledge-form-select" id="commWhen">
                                <option value="Diário">Diário</option>
                                <option value="Semanal">Semanal</option>
                                <option value="Quinzenal">Quinzenal</option>
                                <option value="Mensal">Mensal</option>
                                <option value="Sob demanda">Sob demanda</option>
                            </select>
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📱 Meio</label>
                            <select class="knowledge-form-select" id="commHow">
                                <option value="E-mail">E-mail</option>
                                <option value="Reunião">Reunião</option>
                                <option value="Relatório">Relatório</option>
                                <option value="Dashboard">Dashboard</option>
                                <option value="WhatsApp">WhatsApp</option>
                            </select>
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="addCommPlan()">➕ Adicionar ao Plano</button>
                    
                    <div class="risk-list" style="margin-top: 20px;">
                        ${area.specificData.plan.map((p, i) => `
                            <div class="risk-item">
                                <div class="risk-item-info">
                                    <h4>${p.what}</h4>
                                    <p>Para: ${p.who} | ${p.when} | Via: ${p.how}</p>
                                </div>
                                <button class="knowledge-delete-btn" onclick="deleteCommPlan(${i})">🗑️</button>
                            </div>
                        `).join('') || '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhum item no plano</p>'}
                    </div>
                </div>

                <div class="knowledge-section">
                    <div class="knowledge-section-title">📅 Registro de Reuniões</div>
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📋 Assunto</label>
                            <input type="text" class="knowledge-form-input" id="meetingSubject">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📅 Data</label>
                            <input type="date" class="knowledge-form-input" id="meetingDate">
                        </div>
                        <div class="knowledge-form-field" style="grid-column: 1 / -1;">
                            <label class="knowledge-form-label">📝 Principais Decisões</label>
                            <textarea class="knowledge-form-textarea" id="meetingDecisions"
                                      style="min-height: 80px;"></textarea>
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="addMeeting()">➕ Registrar Reunião</button>
                    
                    <div class="risk-list" style="margin-top: 20px;">
                        ${area.specificData.meetings.map((m, i) => `
                            <div class="risk-item">
                                <div class="risk-item-info">
                                    <h4>${m.subject}</h4>
                                    <p>${new Date(m.date).toLocaleDateString('pt-BR')}</p>
                                    <p style="margin-top: 5px; font-size: 13px;">${m.decisions}</p>
                                </div>
                                <button class="knowledge-delete-btn" onclick="deleteMeeting(${i})">🗑️</button>
                            </div>
                        `).join('') || '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhuma reunião registrada</p>'}
                    </div>
                </div>

                ${renderNotesAndAttachments(area, 'comunicacao')}
            `;
        }

        function addCommPlan() {
            const what = document.getElementById('commWhat').value;
            const who = document.getElementById('commWho').value;
            const when = document.getElementById('commWhen').value;
            const how = document.getElementById('commHow').value;
            if (!what || !who) { alert('Preencha informação e destinatários'); return; }
            knowledgeAreas['comunicacao'].specificData.plan.push({ what, who, when, how });
            saveData();
            renderKnowledgeModalContent('comunicacao');
        }

        function deleteCommPlan(i) {
            if (confirm('Excluir item?')) {
                knowledgeAreas['comunicacao'].specificData.plan.splice(i, 1);
                saveData();
                renderKnowledgeModalContent('comunicacao');
            }
        }

        function addMeeting() {
            const subject = document.getElementById('meetingSubject').value;
            const date = document.getElementById('meetingDate').value;
            const decisions = document.getElementById('meetingDecisions').value;
            if (!subject || !date) { alert('Preencha assunto e data'); return; }
            knowledgeAreas['comunicacao'].specificData.meetings.push({ subject, date, decisions });
            saveData();
            renderKnowledgeModalContent('comunicacao');
        }

        function deleteMeeting(i) {
            if (confirm('Excluir reunião?')) {
                knowledgeAreas['comunicacao'].specificData.meetings.splice(i, 1);
                saveData();
                renderKnowledgeModalContent('comunicacao');
            }
        }

        function renderProcurementContent(area) {
            if (!area.specificData.vendors) area.specificData.vendors = [];
            if (!area.specificData.contracts) area.specificData.contracts = [];
            
            return `
                <div class="knowledge-section">
                    <div class="knowledge-section-title">🛒 Fornecedores</div>
                    <div class="knowledge-help-box">
                        <strong>Gestão de Fornecedores:</strong> Cadastre e acompanhe fornecedores do projeto.
                    </div>
                    
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">🏢 Nome do Fornecedor</label>
                            <input type="text" class="knowledge-form-input" id="vendorName">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📦 Item/Serviço</label>
                            <input type="text" class="knowledge-form-input" id="vendorItem">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📞 Contato</label>
                            <input type="text" class="knowledge-form-input" id="vendorContact">
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="addVendor()">➕ Adicionar Fornecedor</button>
                    
                    <div class="risk-list" style="margin-top: 20px;">
                        ${area.specificData.vendors.map((v, i) => `
                            <div class="risk-item">
                                <div class="risk-item-info">
                                    <h4>🏢 ${v.name}</h4>
                                    <p>${v.item} • 📞 ${v.contact}</p>
                                </div>
                                <button class="knowledge-delete-btn" onclick="deleteVendor(${i})">🗑️</button>
                            </div>
                        `).join('') || '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhum fornecedor cadastrado</p>'}
                    </div>
                </div>

                <div class="knowledge-section">
                    <div class="knowledge-section-title">📄 Contratos</div>
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📋 Descrição</label>
                            <input type="text" class="knowledge-form-input" id="contractDescription">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">💵 Valor (R$)</label>
                            <input type="number" class="knowledge-form-input" id="contractValue" step="0.01">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📅 Vigência</label>
                            <input type="date" class="knowledge-form-input" id="contractDate">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">✅ Status</label>
                            <select class="knowledge-form-select" id="contractStatus">
                                <option value="Em negociação">Em negociação</option>
                                <option value="Assinado">Assinado</option>
                                <option value="Em execução">Em execução</option>
                                <option value="Concluído">Concluído</option>
                            </select>
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="addContract()">➕ Adicionar Contrato</button>
                    
                    <div class="risk-list" style="margin-top: 20px;">
                        ${area.specificData.contracts.map((c, i) => `
                            <div class="risk-item">
                                <div class="risk-item-info">
                                    <h4>${c.description}</h4>
                                    <p>R$ ${parseFloat(c.value).toLocaleString('pt-BR')} • ${new Date(c.date).toLocaleDateString('pt-BR')}</p>
                                </div>
                                <div class="risk-badge ${c.status === 'Assinado' || c.status === 'Em execução' ? 'risk-level-low' : 'risk-level-medium'}">
                                    ${c.status}
                                </div>
                                <button class="knowledge-delete-btn" onclick="deleteContract(${i})">🗑️</button>
                            </div>
                        `).join('') || '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhum contrato registrado</p>'}
                    </div>
                </div>

                ${renderNotesAndAttachments(area, 'aquisicoes')}
            `;
        }

        function addVendor() {
            const name = document.getElementById('vendorName').value;
            const item = document.getElementById('vendorItem').value;
            const contact = document.getElementById('vendorContact').value;
            if (!name || !item) { alert('Preencha nome e item'); return; }
            knowledgeAreas['aquisicoes'].specificData.vendors.push({ name, item, contact });
            saveData();
            renderKnowledgeModalContent('aquisicoes');
        }

        function deleteVendor(i) {
            if (confirm('Excluir fornecedor?')) {
                knowledgeAreas['aquisicoes'].specificData.vendors.splice(i, 1);
                saveData();
                renderKnowledgeModalContent('aquisicoes');
            }
        }

        function addContract() {
            const description = document.getElementById('contractDescription').value;
            const value = document.getElementById('contractValue').value;
            const date = document.getElementById('contractDate').value;
            const status = document.getElementById('contractStatus').value;
            if (!description || !value || !date) { alert('Preencha todos os campos'); return; }
            knowledgeAreas['aquisicoes'].specificData.contracts.push({ description, value, date, status });
            saveData();
            renderKnowledgeModalContent('aquisicoes');
        }

        function deleteContract(i) {
            if (confirm('Excluir contrato?')) {
                knowledgeAreas['aquisicoes'].specificData.contracts.splice(i, 1);
                saveData();
                renderKnowledgeModalContent('aquisicoes');
            }
        }

        function renderIntegrationContent(area) {
            if (!area.specificData.changes) area.specificData.changes = [];
            
            return `
                <div class="knowledge-section">
                    <div class="knowledge-section-title">📋 Termo de Abertura do Projeto (TAP)</div>
                    <div class="knowledge-help-box">
                        <strong>TAP:</strong> Documento que autoriza formalmente o projeto e o gerente de projetos.
                    </div>
                    
                    <div class="knowledge-form-field" style="margin-bottom: 15px;">
                        <label class="knowledge-form-label">🎯 Justificativa do Projeto</label>
                        <textarea class="knowledge-form-textarea" id="tapJustification"
                                  placeholder="Por que este projeto é necessário?">${area.specificData.justification || ''}</textarea>
                    </div>
                    
                    <div class="knowledge-form-field" style="margin-bottom: 15px;">
                        <label class="knowledge-form-label">🎯 Objetivos SMART</label>
                        <textarea class="knowledge-form-textarea" id="tapObjectives"
                                  placeholder="Específicos, Mensuráveis, Atingíveis, Relevantes e Temporais">${area.specificData.objectives || ''}</textarea>
                    </div>
                    
                    <div class="knowledge-form-field" style="margin-bottom: 15px;">
                        <label class="knowledge-form-label">✅ Critérios de Sucesso</label>
                        <textarea class="knowledge-form-textarea" id="tapSuccess"
                                  placeholder="Como saberemos que o projeto foi bem-sucedido?">${area.specificData.success || ''}</textarea>
                    </div>
                    
                    <button class="knowledge-add-btn" onclick="saveTAP()">💾 Salvar TAP</button>
                    <button class="knowledge-add-btn" onclick="generateTAPDocument()" 
                            style="background: #0d6efd; margin-left: 10px;">
                        📄 Gerar Documento TAP
                    </button>
                </div>

                <div class="knowledge-section">
                    <div class="knowledge-section-title">🔄 Controle de Mudanças</div>
                    <div class="knowledge-help-box">
                        <strong>Registro de Mudanças:</strong> Documente todas as mudanças no escopo, cronograma ou orçamento.
                    </div>
                    
                    <div class="knowledge-form-grid">
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📋 Descrição da Mudança</label>
                            <input type="text" class="knowledge-form-input" id="changeDescription">
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📂 Tipo</label>
                            <select class="knowledge-form-select" id="changeType">
                                <option value="Escopo">Escopo</option>
                                <option value="Cronograma">Cronograma</option>
                                <option value="Custo">Custo</option>
                                <option value="Qualidade">Qualidade</option>
                            </select>
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">✅ Status</label>
                            <select class="knowledge-form-select" id="changeStatus">
                                <option value="Solicitado">Solicitado</option>
                                <option value="Em análise">Em análise</option>
                                <option value="Aprovado">Aprovado</option>
                                <option value="Rejeitado">Rejeitado</option>
                                <option value="Implementado">Implementado</option>
                            </select>
                        </div>
                        <div class="knowledge-form-field">
                            <label class="knowledge-form-label">📅 Data</label>
                            <input type="date" class="knowledge-form-input" id="changeDate">
                        </div>
                    </div>
                    <button class="knowledge-add-btn" onclick="addChange()">➕ Registrar Mudança</button>
                    
                    <div class="risk-list" style="margin-top: 20px;">
                        ${area.specificData.changes.map((ch, i) => `
                            <div class="risk-item">
                                <div class="risk-item-info">
                                    <h4>${ch.description}</h4>
                                    <p>${ch.type} • ${new Date(ch.date).toLocaleDateString('pt-BR')}</p>
                                </div>
                                <div class="risk-badge ${ch.status === 'Aprovado' || ch.status === 'Implementado' ? 'risk-level-low' : ch.status === 'Rejeitado' ? 'risk-level-very-high' : 'risk-level-medium'}">
                                    ${ch.status}
                                </div>
                                <button class="knowledge-delete-btn" onclick="deleteChange(${i})">🗑️</button>
                            </div>
                        `).join('') || '<p style="text-align: center; color: #adb5bd; padding: 20px;">Nenhuma mudança registrada</p>'}
                    </div>
                </div>

                ${renderNotesAndAttachments(area, 'integracao')}
            `;
        }

        function saveTAP() {
            const area = knowledgeAreas['integracao'];
            area.specificData.justification = document.getElementById('tapJustification').value;
            area.specificData.objectives = document.getElementById('tapObjectives').value;
            area.specificData.success = document.getElementById('tapSuccess').value;
            saveData();
            
            // Perguntar se deseja gerar o documento
            if (confirm('TAP salvo com sucesso! Deseja gerar o documento completo para impressão?')) {
                generateTAPDocument();
            } else {
                alert('TAP salvo com sucesso!');
            }
        }

        function generateTAPDocument() {
            // Coletar todos os dados do projeto
            const area = knowledgeAreas['integracao'];
            const allTasks = getAllTasks();
            const totalTasks = allTasks.length;
            const completedTasks = allTasks.filter(t => t.completed).length;
            const progressPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            // Calcular datas do projeto
            const allDates = allTasks.map(t => t.startDate).filter(d => d);
            const startDate = allDates.length > 0 ? new Date(Math.min(...allDates.map(d => new Date(d)))) : new Date();
            const endDates = allTasks.map(t => t.endDate).filter(d => d);
            const endDate = endDates.length > 0 ? new Date(Math.max(...endDates.map(d => new Date(d)))) : new Date();
            
            // Calcular orçamento se disponível
            let totalBudget = 'Não definido';
            if (knowledgeAreas['custos'] && knowledgeAreas['custos'].specificData.budget) {
                const budgetTotal = knowledgeAreas['custos'].specificData.budget.reduce((sum, item) => 
                    sum + parseFloat(item.value || 0), 0);
                if (budgetTotal > 0) {
                    totalBudget = 'R$ ' + budgetTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2});
                }
            }
            
            // Criar HTML do documento
            const docHTML = `
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Termo de Abertura do Projeto - ${projectName}</title>
    <style>
        @page {
            size: A4;
            margin: 2cm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            font-size: 11pt;
            line-height: 1.6;
            color: #333;
        }
        
        .container {
            max-width: 100%;
        }
        
        .header {
            text-align: center;
            border-bottom: 3px solid #367962;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #367962;
            font-size: 24pt;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .header .subtitle {
            color: #6c757d;
            font-size: 14pt;
            margin-bottom: 5px;
        }
        
        .header .entity {
            color: #495057;
            font-size: 12pt;
            margin-top: 10px;
        }
        
        .section {
            margin-bottom: 25px;
            page-break-inside: avoid;
        }
        
        .section-title {
            background: #367962;
            color: white;
            padding: 10px 15px;
            font-size: 14pt;
            font-weight: bold;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .section-content {
            padding: 10px 15px;
            background: #f8f9fa;
            border-left: 4px solid #367962;
            min-height: 60px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .info-item {
            background: white;
            border: 1px solid #dee2e6;
            padding: 12px;
            border-radius: 4px;
        }
        
        .info-label {
            font-weight: bold;
            color: #367962;
            font-size: 10pt;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        
        .info-value {
            color: #495057;
            font-size: 11pt;
        }
        
        .stakeholders-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .stakeholders-table th {
            background: #367962;
            color: white;
            padding: 10px;
            text-align: left;
            font-size: 10pt;
        }
        
        .stakeholders-table td {
            border: 1px solid #dee2e6;
            padding: 8px;
            font-size: 10pt;
        }
        
        .stakeholders-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .phases-list {
            list-style: none;
            padding: 0;
        }
        
        .phases-list li {
            background: white;
            border-left: 4px solid #51A65A;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        
        .phase-name {
            font-weight: bold;
            color: #367962;
            margin-bottom: 5px;
        }
        
        .phase-tasks {
            color: #6c757d;
            font-size: 10pt;
        }
        
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #dee2e6;
            text-align: center;
            font-size: 9pt;
            color: #6c757d;
        }
        
        .signatures {
            margin-top: 40px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }
        
        .signature-block {
            text-align: center;
            padding-top: 40px;
            border-top: 1px solid #333;
        }
        
        .signature-label {
            font-weight: bold;
            margin-top: 10px;
        }
        
        @media print {
            body {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
            
            .section {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TERMO DE ABERTURA DO PROJETO</h1>
            <div class="subtitle">Project Charter</div>
            <div class="entity">Prefeitura Municipal de Cuiabá - MT</div>
            <div class="entity">Secretaria de Planejamento Estratégico e Orçamento</div>
        </div>

        <div class="section">
            <div class="section-title">1. IDENTIFICAÇÃO DO PROJETO</div>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Nome do Projeto</div>
                    <div class="info-value">${projectName}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Gerente do Projeto</div>
                    <div class="info-value">${stakeholders.find(s => s.level === 'Gerente de Projeto')?.name || 'Não definido'}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Data de Início</div>
                    <div class="info-value">${startDate.toLocaleDateString('pt-BR')}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Data Prevista de Término</div>
                    <div class="info-value">${endDate.toLocaleDateString('pt-BR')}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Orçamento Estimado</div>
                    <div class="info-value">${totalBudget}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Status Atual</div>
                    <div class="info-value">${progressPercent}% Concluído (${completedTasks} de ${totalTasks} tarefas)</div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">2. JUSTIFICATIVA DO PROJETO</div>
            <div class="section-content">
                ${area.specificData.justification || 'Não informado'}
            </div>
        </div>

        <div class="section">
            <div class="section-title">3. OBJETIVOS DO PROJETO</div>
            <div class="section-content">
                ${area.specificData.objectives || 'Não informado'}
            </div>
        </div>

        <div class="section">
            <div class="section-title">4. CRITÉRIOS DE SUCESSO</div>
            <div class="section-content">
                ${area.specificData.success || 'Não informado'}
            </div>
        </div>

        ${knowledgeAreas['escopo'] && knowledgeAreas['escopo'].specificData.deliverables ? `
        <div class="section">
            <div class="section-title">5. PRINCIPAIS ENTREGAS</div>
            <div class="section-content">
                ${knowledgeAreas['escopo'].specificData.deliverables}
            </div>
        </div>
        ` : ''}

        ${knowledgeAreas['escopo'] && knowledgeAreas['escopo'].specificData.exclusions ? `
        <div class="section">
            <div class="section-title">6. EXCLUSÕES (FORA DO ESCOPO)</div>
            <div class="section-content">
                ${knowledgeAreas['escopo'].specificData.exclusions}
            </div>
        </div>
        ` : ''}

        <div class="section">
            <div class="section-title">7. PARTES INTERESSADAS (STAKEHOLDERS)</div>
            <table class="stakeholders-table">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Cargo/Função</th>
                        <th>Nível de Envolvimento</th>
                    </tr>
                </thead>
                <tbody>
                    ${stakeholders.map(sh => `
                        <tr>
                            <td>${sh.name}</td>
                            <td>${sh.role}</td>
                            <td>${sh.level}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>

        <div class="section">
            <div class="section-title">8. ESTRUTURA DO PROJETO (FASES PMBOK)</div>
            <ul class="phases-list">
                ${Object.keys(phases).map(phaseKey => {
                    const phase = phases[phaseKey];
                    const phaseTasks = phase.tasks.length;
                    const phaseCompleted = phase.tasks.filter(t => t.completed).length;
                    return `
                        <li>
                            <div class="phase-name">${phase.icon} ${phase.name}</div>
                            <div class="phase-tasks">${phaseTasks} tarefas (${phaseCompleted} concluídas)</div>
                        </li>
                    `;
                }).join('')}
            </ul>
        </div>

        ${knowledgeAreas['riscos'] && knowledgeAreas['riscos'].specificData.risks && knowledgeAreas['riscos'].specificData.risks.length > 0 ? `
        <div class="section">
            <div class="section-title">9. PRINCIPAIS RISCOS IDENTIFICADOS</div>
            <table class="stakeholders-table">
                <thead>
                    <tr>
                        <th>Risco</th>
                        <th>Categoria</th>
                        <th>Probabilidade</th>
                        <th>Impacto</th>
                        <th>Nível</th>
                    </tr>
                </thead>
                <tbody>
                    ${knowledgeAreas['riscos'].specificData.risks.slice(0, 10).map(risk => `
                        <tr>
                            <td>${risk.description}</td>
                            <td>${risk.category}</td>
                            <td>${risk.probability}/5</td>
                            <td>${risk.impact}/5</td>
                            <td>${getRiskLevelText(risk.probability * risk.impact)}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
        ` : ''}

        ${area.specificData.changes && area.specificData.changes.length > 0 ? `
        <div class="section" style="page-break-before: always;">
            <div class="section-title">10. REGISTRO DE MUDANÇAS</div>
            <table class="stakeholders-table">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Descrição da Mudança</th>
                        <th>Tipo</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    ${area.specificData.changes.map(change => `
                        <tr>
                            <td>${new Date(change.date).toLocaleDateString('pt-BR')}</td>
                            <td>${change.description}</td>
                            <td>${change.type}</td>
                            <td>${change.status}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
            <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-left: 4px solid #ffc107; font-size: 10pt;">
                <strong>ℹ️ Controle de Mudanças:</strong> Este registro documenta todas as mudanças aprovadas e implementadas no projeto, 
                garantindo rastreabilidade e transparência nas alterações de escopo, cronograma, custos e qualidade.
            </div>
        </div>
        ` : ''}

        <div class="signatures">
            <div class="signature-block">
                <div class="signature-label">Gerente do Projeto</div>
                <div>${stakeholders.find(s => s.level === 'Gerente de Projeto')?.name || '_______________________'}</div>
            </div>
            <div class="signature-block">
                <div class="signature-label">Patrocinador do Projeto</div>
                <div>${stakeholders.find(s => s.level === 'Patrocinador')?.name || '_______________________'}</div>
            </div>
        </div>

        <div class="footer">
            <p>Documento gerado em ${new Date().toLocaleString('pt-BR')}</p>
            <p>Sistema de Gestão de Projetos - Prefeitura de Cuiabá</p>
        </div>
    </div>
</body>
</html>
            `;
            
            // Criar blob e fazer download
            const blob = new Blob([docHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `TAP_${projectName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.html`;
            link.click();
            URL.revokeObjectURL(url);
            
            // Abrir em nova janela para impressão
            const printWindow = window.open('', '_blank');
            printWindow.document.write(docHTML);
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }

        function addChange() {
            const description = document.getElementById('changeDescription').value;
            const type = document.getElementById('changeType').value;
            const status = document.getElementById('changeStatus').value;
            const date = document.getElementById('changeDate').value;
            if (!description || !date) { alert('Preencha descrição e data'); return; }
            knowledgeAreas['integracao'].specificData.changes.push({ description, type, status, date });
            saveData();
            renderKnowledgeModalContent('integracao');
        }

        function deleteChange(i) {
            if (confirm('Excluir mudança?')) {
                knowledgeAreas['integracao'].specificData.changes.splice(i, 1);
                saveData();
                renderKnowledgeModalContent('integracao');
            }
        }

        function renderStakeholderContent(area) {
            const stakeholdersListHTML = stakeholders.map(sh => `
                <div class="stakeholder-item">
                    <div class="stakeholder-avatar">${sh.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase()}</div>
                    <div class="stakeholder-info">
                        <input type="text" value="${sh.name}" onblur="updateStakeholder(${sh.id}, 'name', this.value)" 
                               class="knowledge-form-input" placeholder="Nome">
                        <input type="text" value="${sh.role}" onblur="updateStakeholder(${sh.id}, 'role', this.value)"
                               class="knowledge-form-input" placeholder="Cargo">
                    </div>
                    <select class="knowledge-form-select" onchange="updateStakeholder(${sh.id}, 'level', this.value)">
                        <option value="Patrocinador" ${sh.level === 'Patrocinador' ? 'selected' : ''}>Patrocinador</option>
                        <option value="Gerente de Projeto" ${sh.level === 'Gerente de Projeto' ? 'selected' : ''}>Gerente</option>
                        <option value="Equipe" ${sh.level === 'Equipe' ? 'selected' : ''}>Equipe</option>
                        <option value="Interessado" ${sh.level === 'Interessado' ? 'selected' : ''}>Interessado</option>
                    </select>
                    <button class="knowledge-delete-btn" onclick="deleteStakeholder(${sh.id})">🗑️</button>
                </div>
            `).join('');
            
            return `
                <div class="knowledge-section">
                    <div class="knowledge-section-title">👥 Gerenciamento de Stakeholders</div>
                    <div class="knowledge-help-box">
                        <strong>Stakeholders</strong> são indivíduos ou organizações que podem afetar ou serem afetados pelo projeto.
                    </div>
                    <button class="knowledge-add-btn" onclick="addStakeholder(); setTimeout(() => renderKnowledgeModalContent('partes_interessadas'), 100)">
                        ➕ Adicionar Stakeholder
                    </button>
                    <div class="modal-stakeholders-list" style="margin-top: 20px;">
                        ${stakeholdersListHTML}
                    </div>
                </div>
                ${renderNotesAndAttachments(area, 'partes_interessadas')}
            `;
        }

        function updateKnowledgeArea(areaKey, notes) {
            knowledgeAreas[areaKey].notes = notes;
            saveData();
        }

        function uploadKnowledgeAttachment(areaKey) {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.accept = '.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.txt,.csv,.zip,.rar';
            
            input.onchange = (e) => {
                const files = Array.from(e.target.files);
                const area = knowledgeAreas[areaKey];
                
                if (!area.attachments) area.attachments = [];
                
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        area.attachments.push({
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            data: event.target.result,
                            date: new Date().toISOString()
                        });
                        saveData();
                        renderKnowledgeAreas();
                    };
                    reader.readAsDataURL(file);
                });
            };
            
            input.click();
        }

        function downloadKnowledgeAttachment(areaKey, attachmentIndex) {
            const area = knowledgeAreas[areaKey];
            const attachment = area.attachments[attachmentIndex];
            
            const link = document.createElement('a');
            link.href = attachment.data;
            link.download = attachment.name;
            link.click();
        }

        function deleteKnowledgeAttachment(areaKey, attachmentIndex) {
            if (confirm('Tem certeza que deseja excluir este anexo?')) {
                const area = knowledgeAreas[areaKey];
                area.attachments.splice(attachmentIndex, 1);
                saveData();
                renderKnowledgeAreas();
            }
        }

        // Obter todas as tarefas
        function getAllTasks() {
            let allTasks = [];
            Object.keys(phases).forEach(phaseKey => {
                allTasks = allTasks.concat(phases[phaseKey].tasks);
            });
            return allTasks;
        }

        // Renderizar fases
        function renderPhases() {
            const phasesList = document.getElementById('phasesList');
            phasesList.innerHTML = '';

            Object.keys(phases).forEach(phaseKey => {
                const phase = phases[phaseKey];
                const phaseTasks = phase.tasks;
                const completedCount = phaseTasks.filter(t => t.completed).length;
                const totalCount = phaseTasks.length;
                const progress = totalCount > 0 ? (completedCount / totalCount * 100).toFixed(0) : 0;

                const phaseDiv = document.createElement('div');
                phaseDiv.className = 'phase-container';
                
                const isExpanded = expandedPhases[phaseKey];

                phaseDiv.innerHTML = `
                    <div class="phase-header phase-${phase.color}" onclick="togglePhase('${phaseKey}')">
                        <div class="phase-title-section">
                            <div class="phase-icon">${phase.icon}</div>
                            <div class="phase-title-content">
                                <h3>${phase.name}</h3>
                                <div class="phase-subtitle">${phase.subtitle}</div>
                            </div>
                        </div>
                        <div class="phase-stats">
                            <div class="phase-stat">
                                <div class="phase-stat-value">${completedCount}/${totalCount}</div>
                                <div class="phase-stat-label">Tarefas</div>
                            </div>
                            <div class="phase-progress-container">
                                <div class="phase-progress-bar">
                                    <div class="phase-progress-fill" style="width: ${progress}%"></div>
                                </div>
                                <div style="text-align: center; margin-top: 5px; font-size: 12px; font-weight: 700;">${progress}%</div>
                            </div>
                            <div class="toggle-icon ${isExpanded ? 'rotated' : ''}">▼</div>
                        </div>
                    </div>
                    <div class="phase-content ${isExpanded ? 'active' : ''}" id="phase-${phaseKey}">
                        <div id="tasks-${phaseKey}"></div>
                        <button class="add-task-btn" onclick="addTaskToPhase('${phaseKey}')">
                            ➕ Adicionar Tarefa nesta Fase
                        </button>
                    </div>
                `;

                phasesList.appendChild(phaseDiv);
                renderPhaseTasks(phaseKey);
            });

            updateStats();
        }

        // Renderizar tarefas de uma fase
        function renderPhaseTasks(phaseKey) {
            const tasksContainer = document.getElementById(`tasks-${phaseKey}`);
            if (!tasksContainer) return;

            tasksContainer.innerHTML = '';
            const phaseTasks = phases[phaseKey].tasks;

            phaseTasks.forEach(task => {
                const taskDiv = document.createElement('div');
                taskDiv.className = `task-item ${task.completed ? 'task-completed' : ''}`;
                
                const statusClass = `status-${task.status}`;
                const statusText = {
                    'nao-iniciada': 'Não Iniciada',
                    'em-andamento': 'Em Andamento',
                    'concluida': 'Concluída',
                    'atrasada': 'Atrasada',
                    'em-revisao': 'Em Revisão'
                }[task.status];

                // Renderizar lista de anexos
                let attachmentsHTML = '';
                if (!task.attachments) task.attachments = [];
                
                if (task.attachments.length > 0) {
                    attachmentsHTML = task.attachments.map((att, index) => `
                        <div class="attachment-item">
                            <div class="attachment-info">
                                <div class="attachment-icon">${getFileIcon(att.name)}</div>
                                <div class="attachment-details">
                                    <div class="attachment-name">${att.name}</div>
                                    <div class="attachment-meta">${formatFileSize(att.size)} • ${new Date(att.date).toLocaleDateString('pt-BR')}</div>
                                </div>
                            </div>
                            <div class="attachment-actions">
                                <button class="attachment-action-btn attachment-download-btn" onclick="downloadAttachment('${phaseKey}', ${task.id}, ${index})">
                                    ⬇️ Baixar
                                </button>
                                <button class="attachment-action-btn attachment-delete-btn" onclick="deleteAttachment('${phaseKey}', ${task.id}, ${index})">
                                    🗑️
                                </button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    attachmentsHTML = '<div class="no-attachments">📎 Nenhum documento anexado</div>';
                }

                taskDiv.innerHTML = `
                    <div class="task-header">
                        <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} 
                               onchange="toggleTask('${phaseKey}', ${task.id})">
                        <div class="task-info">
                            <div class="task-title">
                                <input type="text" value="${task.title}" 
                                       onchange="updateTaskField('${phaseKey}', ${task.id}, 'title', this.value)">
                            </div>
                            <div class="task-description">
                                <textarea onchange="updateTaskField('${phaseKey}', ${task.id}, 'description', this.value)"
                                          placeholder="Descrição da tarefa...">${task.description || ''}</textarea>
                            </div>
                            <div class="task-meta">
                                <div class="task-meta-item">
                                    <span class="task-meta-label">👤 Responsável</span>
                                    <input type="text" value="${task.responsible}" 
                                           onchange="updateTaskField('${phaseKey}', ${task.id}, 'responsible', this.value)">
                                </div>
                                <div class="task-meta-item">
                                    <span class="task-meta-label">📅 Data Início</span>
                                    <input type="date" value="${task.startDate}" 
                                           onchange="updateTaskField('${phaseKey}', ${task.id}, 'startDate', this.value)">
                                </div>
                                <div class="task-meta-item">
                                    <span class="task-meta-label">🏁 Data Término</span>
                                    <input type="date" value="${task.endDate}" 
                                           onchange="updateTaskField('${phaseKey}', ${task.id}, 'endDate', this.value)">
                                </div>
                                <div class="task-meta-item">
                                    <span class="task-meta-label">📊 Status</span>
                                    <select onchange="updateTaskField('${phaseKey}', ${task.id}, 'status', this.value)">
                                        <option value="nao-iniciada" ${task.status === 'nao-iniciada' ? 'selected' : ''}>Não Iniciada</option>
                                        <option value="em-andamento" ${task.status === 'em-andamento' ? 'selected' : ''}>Em Andamento</option>
                                        <option value="em-revisao" ${task.status === 'em-revisao' ? 'selected' : ''}>Em Revisão</option>
                                        <option value="concluida" ${task.status === 'concluida' ? 'selected' : ''}>Concluída</option>
                                        <option value="atrasada" ${task.status === 'atrasada' ? 'selected' : ''}>Atrasada</option>
                                    </select>
                                </div>
                            </div>
                            <div class="task-attachments">
                                <div class="attachments-header">
                                    <div class="attachments-title">
                                        📎 Documentos Anexados (${task.attachments.length})
                                    </div>
                                    <button class="attachment-upload-btn" onclick="uploadAttachment('${phaseKey}', ${task.id})">
                                        ➕ Anexar Documento
                                    </button>
                                </div>
                                <div class="attachments-list">
                                    ${attachmentsHTML}
                                </div>
                            </div>
                            <div style="margin-top: 15px; display: flex; gap: 10px; align-items: center;">
                                <span class="status-badge ${statusClass}">${statusText}</span>
                                <button class="delete-btn" onclick="deleteTask('${phaseKey}', ${task.id})">🗑️ Excluir Tarefa</button>
                            </div>
                        </div>
                    </div>
                `;
                
                tasksContainer.appendChild(taskDiv);
            });
        }

        // Toggle fase
        function togglePhase(phaseKey) {
            expandedPhases[phaseKey] = !expandedPhases[phaseKey];
            saveData();
            renderPhases();
        }

        // Toggle todas as fases
        function toggleAllPhases() {
            const allExpanded = Object.keys(phases).every(key => expandedPhases[key]);
            Object.keys(phases).forEach(key => {
                expandedPhases[key] = !allExpanded;
            });
            saveData();
            renderPhases();
        }

        // Toggle tarefa
        function toggleTask(phaseKey, taskId) {
            const task = phases[phaseKey].tasks.find(t => t.id === taskId);
            task.completed = !task.completed;
            if (task.completed) {
                task.status = 'concluida';
            }
            saveData();
            renderPhases();
            renderScrumban();
        }

        // Atualizar campo da tarefa
        function updateTaskField(phaseKey, taskId, field, value) {
            const task = phases[phaseKey].tasks.find(t => t.id === taskId);
            task[field] = value;
            saveData();
            renderPhases();
            if (field === 'status') {
                renderScrumban();
            }
        }

        // Adicionar tarefa
        function addTaskToPhase(phaseKey) {
            const allTasks = getAllTasks();
            const maxId = Math.max(...allTasks.map(t => t.id), 0);
            
            const newTask = {
                id: maxId + 1,
                title: "Nova Tarefa",
                description: "",
                responsible: "Responsável",
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date().toISOString().split('T')[0],
                status: "nao-iniciada",
                completed: false,
                        attachments: []
            };
            
            phases[phaseKey].tasks.push(newTask);
            saveData();
            renderPhases();
        }

        // Deletar tarefa
        function deleteTask(phaseKey, taskId) {
            if (confirm('Tem certeza que deseja excluir esta tarefa?')) {
                phases[phaseKey].tasks = phases[phaseKey].tasks.filter(t => t.id !== taskId);
                saveData();
                renderPhases();
            }
        }

        // Atualizar estatísticas
        function updateStats() {
            const allTasks = getAllTasks();
            const total = allTasks.length;
            const completed = allTasks.filter(t => t.completed).length;
            const inProgress = allTasks.filter(t => t.status === 'em-andamento' && !t.completed).length;
            const delayed = allTasks.filter(t => t.status === 'atrasada' && !t.completed).length;
            const completionRate = total > 0 ? (completed / total * 100).toFixed(0) : 0;

            document.getElementById('totalTasks').textContent = total;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('inProgressTasks').textContent = inProgress;
            document.getElementById('delayedTasks').textContent = delayed;
            document.getElementById('completedProgress').style.width = completionRate + '%';
            
            // Atualizar novo header de progresso
            document.getElementById('headerProgressValue').textContent = completionRate + '%';
            document.getElementById('headerProgressBar').style.width = completionRate + '%';
            document.getElementById('headerProgressText').textContent = completionRate + '%';
            document.getElementById('headerCompletedCount').textContent = completed;
            document.getElementById('headerTotalCount').textContent = total;
            
            // Calcular fases completas
            const phasesComplete = Object.keys(phases).filter(phaseKey => {
                const phaseTasks = phases[phaseKey].tasks;
                return phaseTasks.length > 0 && phaseTasks.every(t => t.completed);
            }).length;
            document.getElementById('headerPhases').textContent = `${phasesComplete}/5`;
        }

        // Funções de modal para detalhamento
        function showTaskDetails(type) {
            const modal = document.getElementById('taskModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            const allTasks = getAllTasks();
            let filteredTasks = [];
            let title = '';
            let icon = '';
            
            switch(type) {
                case 'completed':
                    filteredTasks = allTasks.filter(t => t.completed);
                    title = '✅ Tarefas Concluídas';
                    icon = '✅';
                    break;
                case 'inProgress':
                    filteredTasks = allTasks.filter(t => t.status === 'em-andamento' && !t.completed);
                    title = '🔄 Tarefas Em Andamento';
                    icon = '🔄';
                    break;
                case 'delayed':
                    filteredTasks = allTasks.filter(t => t.status === 'atrasada' && !t.completed);
                    title = '⚠️ Tarefas Atrasadas';
                    icon = '⚠️';
                    break;
            }
            
            modalTitle.innerHTML = `<span>${icon}</span> ${title} (${filteredTasks.length})`;
            
            if (filteredTasks.length === 0) {
                modalBody.innerHTML = `
                    <div class="modal-empty">
                        <div class="modal-empty-icon">${icon}</div>
                        <div class="modal-empty-text">Nenhuma tarefa encontrada nesta categoria</div>
                    </div>
                `;
            } else {
                modalBody.innerHTML = filteredTasks.map(task => {
                    // Encontrar a fase da tarefa
                    let phaseName = '';
                    let phaseIcon = '';
                    Object.keys(phases).forEach(phaseKey => {
                        if (phases[phaseKey].tasks.some(t => t.id === task.id)) {
                            phaseName = phases[phaseKey].name;
                            phaseIcon = phases[phaseKey].icon;
                        }
                    });
                    
                    const startDate = new Date(task.startDate).toLocaleDateString('pt-BR');
                    const endDate = new Date(task.endDate).toLocaleDateString('pt-BR');
                    
                    return `
                        <div class="modal-task-item">
                            <div class="modal-task-title">${task.title}</div>
                            <div class="modal-task-meta">
                                <div class="modal-task-meta-item">
                                    <strong>${phaseIcon} Fase:</strong> ${phaseName}
                                </div>
                                <div class="modal-task-meta-item">
                                    <strong>👤 Responsável:</strong> ${task.responsible}
                                </div>
                                <div class="modal-task-meta-item">
                                    <strong>📅 Início:</strong> ${startDate}
                                </div>
                                <div class="modal-task-meta-item">
                                    <strong>🏁 Término:</strong> ${endDate}
                                </div>
                                ${task.attachments && task.attachments.length > 0 ? `
                                <div class="modal-task-meta-item">
                                    <strong>📎 Anexos:</strong> ${task.attachments.length}
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            modal.classList.add('active');
        }
        
        function closeModal() {
            const modal = document.getElementById('taskModal');
            modal.classList.remove('active');
        }
        
        // Fechar modal ao clicar fora dele
        window.onclick = function(event) {
            const modal = document.getElementById('taskModal');
            if (event.target === modal) {
                closeModal();
            }
        }
        
        // Fechar modal com ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });

        // Funções para gerenciar anexos
        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const icons = {
                'pdf': '📄',
                'doc': '📝',
                'docx': '📝',
                'xls': '📊',
                'xlsx': '📊',
                'ppt': '📽️',
                'pptx': '📽️',
                'jpg': '🖼️',
                'jpeg': '🖼️',
                'png': '🖼️',
                'gif': '🖼️',
                'zip': '🗜️',
                'rar': '🗜️',
                'txt': '📃',
                'csv': '📋'
            };
            return icons[ext] || '📎';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function uploadAttachment(phaseKey, taskId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.accept = '.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.txt,.csv,.zip,.rar';
            
            input.onchange = (e) => {
                const files = Array.from(e.target.files);
                const task = phases[phaseKey].tasks.find(t => t.id === taskId);
                
                if (!task.attachments) task.attachments = [];
                
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        task.attachments.push({
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            data: event.target.result,
                            date: new Date().toISOString()
                        });
                        saveData();
                        renderPhases();
                    };
                    reader.readAsDataURL(file);
                });
            };
            
            input.click();
        }

        function downloadAttachment(phaseKey, taskId, attachmentIndex) {
            const task = phases[phaseKey].tasks.find(t => t.id === taskId);
            const attachment = task.attachments[attachmentIndex];
            
            const link = document.createElement('a');
            link.href = attachment.data;
            link.download = attachment.name;
            link.click();
        }

        function deleteAttachment(phaseKey, taskId, attachmentIndex) {
            if (confirm('Tem certeza que deseja excluir este anexo?')) {
                const task = phases[phaseKey].tasks.find(t => t.id === taskId);
                task.attachments.splice(attachmentIndex, 1);
                saveData();
                renderPhases();
            }
        }

        // Renderizar calendário
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthYear = document.getElementById('currentMonth');
            
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                               'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            monthYear.textContent = `${monthNames[month]} ${year}`;
            
            grid.innerHTML = '';
            
            // Dias da semana
            const dayHeaders = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });
            
            // Primeiro dia do mês
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            // Dias do mês anterior
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = document.createElement('div');
                day.className = 'calendar-day other-month';
                day.textContent = daysInPrevMonth - i;
                grid.appendChild(day);
            }
            
            // Dias do mês atual
            const today = new Date();
            const allTasks = getAllTasks();
            
            for (let i = 1; i <= daysInMonth; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.textContent = i;
                
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                
                // Marcar hoje
                if (today.getDate() === i && today.getMonth() === month && today.getFullYear() === year) {
                    day.classList.add('today');
                }
                
                // Marcar dias com eventos
                const tasksForDay = allTasks.filter(t => 
                    t.startDate === dateStr || t.endDate === dateStr
                );
                const eventsForDay = events.filter(e => e.date === dateStr);
                
                if (tasksForDay.length > 0 || eventsForDay.length > 0) {
                    day.classList.add('has-tasks');
                    const indicator = document.createElement('div');
                    indicator.className = 'calendar-day-indicator';
                    for (let j = 0; j < Math.min(tasksForDay.length + eventsForDay.length, 3); j++) {
                        const dot = document.createElement('div');
                        dot.className = 'calendar-day-dot';
                        indicator.appendChild(dot);
                    }
                    day.appendChild(indicator);
                }
                
                grid.appendChild(day);
            }
            
            // Completar com dias do próximo mês
            const totalCells = grid.children.length - 7;
            const remainingCells = 42 - totalCells - 7;
            for (let i = 1; i <= remainingCells; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day other-month';
                day.textContent = i;
                grid.appendChild(day);
            }
        }

        // Mudar mês
        function changeMonth(direction) {
            currentMonth.setMonth(currentMonth.getMonth() + direction);
            renderCalendar();
        }

        // Renderizar eventos
        function renderEvents() {
            const eventsList = document.getElementById('eventsList');
            eventsList.innerHTML = '';
            
            const sortedEvents = [...events].sort((a, b) => new Date(a.date) - new Date(b.date));
            const upcomingEvents = sortedEvents.filter(e => new Date(e.date) >= new Date());
            
            if (upcomingEvents.length === 0) {
                eventsList.innerHTML = '<p style="color: #6c757d; font-size: 13px;">Nenhum compromisso próximo</p>';
                return;
            }
            
            upcomingEvents.slice(0, 5).forEach(event => {
                const eventDiv = document.createElement('div');
                eventDiv.className = 'event-item';
                
                const dateObj = new Date(event.date + 'T00:00:00');
                const formattedDate = dateObj.toLocaleDateString('pt-BR', { 
                    day: '2-digit', 
                    month: '2-digit',
                    year: 'numeric'
                });
                
                eventDiv.innerHTML = `
                    <div class="event-date">${formattedDate}</div>
                    <div class="event-title">${event.title}</div>
                `;
                eventsList.appendChild(eventDiv);
            });
        }

        // Adicionar evento
        function addEvent() {
            const dateInput = document.getElementById('eventDate');
            const titleInput = document.getElementById('eventTitle');
            
            if (!dateInput.value || !titleInput.value) {
                alert('Preencha data e descrição do compromisso');
                return;
            }
            
            events.push({
                date: dateInput.value,
                title: titleInput.value
            });
            
            dateInput.value = '';
            titleInput.value = '';
            
            saveData();
            renderEvents();
            renderCalendar();
        }

        // Exportar dados
        function exportData() {
            const data = {
                projectName: projectName,
                stakeholders: stakeholders,
                knowledgeAreas: knowledgeAreas,
                phases: phases,
                events: events,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            
            // Nome do arquivo baseado no nome do projeto
            const fileName = projectName.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
            link.download = `${fileName}-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // Importar dados
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.phases) phases = data.phases;
                        if (data.events) events = data.events;
                        if (data.projectName) {
                            projectName = data.projectName;
                            document.getElementById('projectNameInput').value = projectName;
                            document.getElementById('headerProjectName').textContent = projectName;
                        }
                        if (data.stakeholders) {
                            stakeholders = data.stakeholders;
                        }
                        if (data.knowledgeAreas) {
                            knowledgeAreas = data.knowledgeAreas;
                        }
                        saveData();
                        renderPhases();
                        renderEvents();
                        renderCalendar();
                        renderStakeholders();
                        renderKnowledgeAreas();
                        alert('Dados importados com sucesso!');
                    } catch (error) {
                        alert('Erro ao importar dados. Verifique o arquivo.');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        // Integração com estrutura de unidades e projetos
        let currentProjectData = null;
        let allUnits = [];

        function loadProjectFromStructure() {
            // Carregar unidades
            const savedUnits = localStorage.getItem('governanceUnits');
            if (savedUnits) {
                allUnits = JSON.parse(savedUnits);
            }

            // Pegar IDs selecionados
            const unitId = parseInt(localStorage.getItem('selectedUnitId'));
            const projectId = parseInt(localStorage.getItem('selectedProjectId'));

            if (!unitId || !projectId) {
                // Se não houver seleção, usar modo standalone
                return;
            }

            // Encontrar unidade e projeto
            const currentUnit = allUnits.find(u => u.id === unitId);
            if (currentUnit) {
                currentProjectData = currentUnit.projects?.find(p => p.id === projectId);
                
                if (currentProjectData) {
                    // Atualizar breadcrumb
                    document.getElementById('breadcrumbUnit').textContent = currentUnit.name;
                    document.getElementById('breadcrumbProject').textContent = currentProjectData.name;
                    
                    // Atualizar nome do projeto no header
                    projectName = currentProjectData.name;
                    document.getElementById('projectNameInput').value = projectName;
                    document.getElementById('headerProjectName').textContent = projectName;
                    
                    // Carregar dados do projeto se existirem
                    if (currentProjectData.projectData) {
                        const data = currentProjectData.projectData;
                        if (data.phases) phases = data.phases;
                        if (data.events) events = data.events;
                        if (data.stakeholders) stakeholders = data.stakeholders;
                        if (data.knowledgeAreas) knowledgeAreas = data.knowledgeAreas;
                        if (data.expandedPhases) expandedPhases = data.expandedPhases;
                    }
                }
            }
        }

        // Sobrescrever saveData para salvar também na estrutura
        const originalSaveData = saveData;
        saveData = function() {
            originalSaveData();
            
            // Salvar também na estrutura de projetos
            const unitId = parseInt(localStorage.getItem('selectedUnitId'));
            const projectId = parseInt(localStorage.getItem('selectedProjectId'));
            
            if (unitId && projectId && allUnits.length > 0) {
                const unit = allUnits.find(u => u.id === unitId);
                if (unit) {
                    const project = unit.projects?.find(p => p.id === projectId);
                    if (project) {
                        // Atualizar dados do projeto
                        project.name = projectName;
                        project.projectData = {
                            phases: phases,
                            events: events,
                            stakeholders: stakeholders,
                            knowledgeAreas: knowledgeAreas,
                            expandedPhases: expandedPhases
                        };
                        
                        // Calcular progresso
                        const allTasks = getAllTasks();
                        const completed = allTasks.filter(t => t.completed).length;
                        project.progress = allTasks.length > 0 ? 
                            Math.round((completed / allTasks.length) * 100) : 0;
                        project.completedTasks = completed;
                        
                        // Salvar unidades atualizadas
                        localStorage.setItem('governanceUnits', JSON.stringify(allUnits));
                    }
                }
            }
        };

        // Inicialização
        loadProjectFromStructure();
        loadData();
        document.getElementById('projectNameInput').value = projectName;
        document.getElementById('headerProjectName').textContent = projectName;
        renderStakeholders();
        renderKnowledgeAreas();
        renderScrumban();
        renderPhases();
        renderCalendar();
        renderEvents();
    </script>
</body>
</html>