import{j as e,c as o}from"./utils.BdS-FAhz.js";import{u as ie,P as oe}from"./providers.UQtKWlBt.js";import{r as i}from"./index.DIfZGIpv.js";import{O as M,P as ne,C as B,a as le,X as de,T as q,D as H,R as ce,u as I,b as z,c as b}from"./x.CzxnF3Yo.js";import{C as _,a as $,b as K,c as me}from"./card.COi6a3zU.js";import{c as xe,B as c}from"./button.C7nr6ow3.js";import{I as n,L as u}from"./label.CX8mjn5I.js";import{B as ue,D as he,a as pe,b as je,c as fe,d as P,e as ge,T as be,A as Q}from"./badge.Bk1XBo-w.js";import{c as E}from"./createLucideIcon.BT1YvhfI.js";import{S as Ne}from"./search.Qw-1NHMa.js";import{P as ye}from"./plus.UANvjMxu.js";import{B as O}from"./building-2.DMSmHH9f.js";import{L as we}from"./layout-dashboard.D2FpTZ5V.js";import"./index.XeJbqeyU.js";import"./index.DBb4ffa2.js";import"./index.nvHwJhPY.js";import"./circle.C221g-he.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Se=E("ellipsis",ve);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Te=E("shield",Ce);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],ke=E("square-pen",Ae),De=ce,Ee=ne,V=i.forwardRef(({className:t,...r},a)=>e.jsx(M,{className:o("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r,ref:a}));V.displayName=M.displayName;const Re=xe("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),G=i.forwardRef(({side:t="right",className:r,children:a,...m},N)=>e.jsxs(Ee,{children:[e.jsx(V,{}),e.jsxs(B,{ref:N,className:o(Re({side:t}),r),...m,children:[e.jsxs(le,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),a]})]}));G.displayName=B.displayName;const J=({className:t,...r})=>e.jsx("div",{className:o("flex flex-col space-y-2 text-center sm:text-left",t),...r});J.displayName="SheetHeader";const U=({className:t,...r})=>e.jsx("div",{className:o("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r});U.displayName="SheetFooter";const X=i.forwardRef(({className:t,...r},a)=>e.jsx(q,{ref:a,className:o("text-lg font-semibold text-foreground",t),...r}));X.displayName=q.displayName;const W=i.forwardRef(({className:t,...r},a)=>e.jsx(H,{ref:a,className:o("text-sm text-muted-foreground",t),...r}));W.displayName=H.displayName;function Fe(){const t=ie(),[r,a]=i.useState(!1),[m,N]=i.useState(""),[x,y]=i.useState(null),[w,h]=i.useState(""),[v,p]=i.useState(""),[S,j]=i.useState(""),[C,f]=i.useState(""),[T,g]=i.useState(""),{data:ae,isLoading:se}=I({queryKey:["organizations"],queryFn:async()=>{const s=await b.organizations.$get();if(!s.ok)throw new Error("Failed to fetch");return s.json()}}),A=z({mutationFn:async()=>{const s=await b.organizations.$post({json:{name:w,code:v,secretario:S,secretariaAdjunta:C,diretoriaTecnica:T}});if(!s.ok)throw new Error("Failed to create");return s.json()},onSuccess:()=>{t.invalidateQueries({queryKey:["organizations"]}),R()}}),k=z({mutationFn:async s=>{const L=await b.organizations[":id"].$put({param:{id:s.id},json:{name:s.name,code:s.code,secretario:s.secretario,secretariaAdjunta:s.secretariaAdjunta,diretoriaTecnica:s.diretoriaTecnica}});if(!L.ok)throw new Error("Failed to update");return L.json()},onSuccess:()=>{t.invalidateQueries({queryKey:["organizations"]}),R()}});function R(){a(!1),y(null),h(""),p(""),j(""),f(""),g("")}function te(s){y(s.id),h(s.name),p(s.code),j(s.secretario||""),f(s.secretariaAdjunta||""),g(s.diretoriaTecnica||""),a(!0)}function re(){y(null),h(""),p(""),j(""),f(""),g(""),a(!0)}const F=ae?.filter(s=>s.name.toLowerCase().includes(m.toLowerCase())||s.code.toLowerCase().includes(m.toLowerCase()));return se?e.jsx("div",{children:"Carregando..."}):e.jsxs("div",{className:"space-y-8 max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-6 pb-6 border-b border-slate-200",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold tracking-tight text-slate-900 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Te,{className:"h-6 w-6 text-blue-700"})}),"Gestão de Secretarias"]}),e.jsx("p",{className:"text-slate-500 mt-2 max-w-lg",children:"Gerencie as unidades orçamentárias e configure permissões de acesso."})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(Ne,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(n,{placeholder:"Buscar secretaria...",className:"pl-9 bg-white border-slate-200",value:m,onChange:s=>N(s.target.value)})]}),e.jsxs(De,{open:r,onOpenChange:a,children:[e.jsxs(c,{onClick:re,className:"bg-blue-600 hover:bg-blue-700 text-white shadow-sm",children:[e.jsx(ye,{className:"mr-2 h-4 w-4"})," Nova Secretaria"]}),e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(X,{children:x?"Editar Secretaria":"Nova Secretaria"}),e.jsx(W,{children:x?"Atualize os dados da unidade orçamentária abaixo.":"Preencha os dados para cadastrar uma nova unidade orçamentária."})]}),e.jsxs("div",{className:"space-y-6 py-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"name",children:"Nome da Secretaria"}),e.jsx(n,{id:"name",value:w,onChange:s=>h(s.target.value),placeholder:"Ex: Secretaria de Saúde"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"code",children:"Sigla / Código"}),e.jsx(n,{id:"code",value:v,onChange:s=>p(s.target.value),placeholder:"Ex: SMS"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"secretario",children:"Secretário(a)"}),e.jsx(n,{id:"secretario",value:S,onChange:s=>j(s.target.value),placeholder:"Nome do Secretário(a)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"secretariaAdjunta",children:"Secretário(a) Adjunto(a)"}),e.jsx(n,{id:"secretariaAdjunta",value:C,onChange:s=>f(s.target.value),placeholder:"Nome do Secretário(a) Adjunto(a)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"diretoriaTecnica",children:"Diretor(a) Técnico(a)"}),e.jsx(n,{id:"diretoriaTecnica",value:T,onChange:s=>g(s.target.value),placeholder:"Nome do Diretor(a) Técnico(a)"})]})]}),e.jsxs(U,{children:[e.jsx(c,{variant:"outline",onClick:()=>a(!1),children:"Cancelar"}),e.jsx(c,{onClick:()=>x?k.mutate({id:x,name:w,code:v,secretario:S,secretariaAdjunta:C,diretoriaTecnica:T}):A.mutate(),disabled:A.isPending||k.isPending,className:"bg-blue-600 hover:bg-blue-700 text-white",children:A.isPending||k.isPending?"Salvando...":x?"Salvar Alterações":"Criar Secretaria"})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:F?.map(s=>e.jsxs(_,{className:"group hover:shadow-lg transition-all duration-300 border-slate-200 bg-white",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-slate-50 flex items-center justify-center border border-slate-100",children:e.jsx(O,{className:"h-5 w-5 text-slate-400"})}),e.jsx("div",{children:e.jsx(ue,{variant:"secondary",className:"bg-slate-100 text-slate-700 hover:bg-slate-200 font-medium",children:s.code})})]}),e.jsxs(he,{children:[e.jsx(pe,{asChild:!0,children:e.jsxs(c,{variant:"ghost",className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Se,{className:"h-4 w-4 text-slate-400"})]})}),e.jsxs(je,{align:"end",children:[e.jsx(fe,{children:"Ações"}),e.jsxs(P,{onClick:()=>te(s),children:[e.jsx(ke,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsx(ge,{}),e.jsxs(P,{className:"text-red-600",children:[e.jsx(be,{className:"mr-2 h-4 w-4"})," Excluir"]})]})]})]}),e.jsxs(K,{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 line-clamp-2 min-h-[3.5rem] mb-2",children:s.name}),e.jsxs("p",{className:"text-xs text-slate-400 font-mono",children:["ID: ",s.id.slice(0,8),"..."]})]})]},s.id))}),F?.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-slate-100 mb-4",children:e.jsx(O,{className:"h-8 w-8 text-slate-400"})}),e.jsx("h3",{className:"text-lg font-medium text-slate-900",children:"Nenhuma secretaria encontrada"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Tente buscar por outro termo ou adicione uma nova."})]})]})}const Y=i.forwardRef(({className:t,...r},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:o("w-full caption-bottom text-sm",t),...r})}));Y.displayName="Table";const Z=i.forwardRef(({className:t,...r},a)=>e.jsx("thead",{ref:a,className:o("[&_tr]:border-b",t),...r}));Z.displayName="TableHeader";const ee=i.forwardRef(({className:t,...r},a)=>e.jsx("tbody",{ref:a,className:o("[&_tr:last-child]:border-0",t),...r}));ee.displayName="TableBody";const Le=i.forwardRef(({className:t,...r},a)=>e.jsx("tfoot",{ref:a,className:o("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...r}));Le.displayName="TableFooter";const D=i.forwardRef(({className:t,...r},a)=>e.jsx("tr",{ref:a,className:o("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...r}));D.displayName="TableRow";const l=i.forwardRef(({className:t,...r},a)=>e.jsx("th",{ref:a,className:o("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...r}));l.displayName="TableHead";const d=i.forwardRef(({className:t,...r},a)=>e.jsx("td",{ref:a,className:o("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...r}));d.displayName="TableCell";const ze=i.forwardRef(({className:t,...r},a)=>e.jsx("caption",{ref:a,className:o("mt-4 text-sm text-muted-foreground",t),...r}));ze.displayName="TableCaption";function Pe(){const{data:t,isLoading:r}=I({queryKey:["audit-logs"],queryFn:async()=>{const a=await b.admin["audit-logs"].$get();if(!a.ok)throw new Error("Failed to fetch logs");return a.json()}});return r?e.jsx("div",{className:"p-4 text-center",children:"Carregando auditoria..."}):e.jsxs(_,{children:[e.jsxs($,{className:"flex flex-row items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-primary"}),e.jsx(me,{children:"Logs de Auditoria"})]}),e.jsx(K,{children:e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(D,{children:[e.jsx(l,{children:"Data/Hora"}),e.jsx(l,{children:"Usuário"}),e.jsx(l,{children:"Ação"}),e.jsx(l,{children:"Recurso"}),e.jsx(l,{children:"Detalhes"})]})}),e.jsx(ee,{children:t?.map(a=>e.jsxs(D,{className:"text-xs",children:[e.jsx(d,{children:new Date(a.createdAt).toLocaleString("pt-BR")}),e.jsxs(d,{children:[e.jsx("div",{className:"font-medium",children:a.userName}),e.jsx("div",{className:"text-muted-foreground",children:a.userEmail})]}),e.jsx(d,{children:e.jsx("span",{className:`px-2 py-1 rounded-full text-[10px] font-bold ${a.action==="CREATE"?"bg-green-100 text-green-700":a.action==="DELETE"?"bg-red-100 text-red-700":a.action==="UPDATE"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:a.action})}),e.jsx(d,{children:a.resource}),e.jsx(d,{className:"max-w-[200px] truncate",title:a.metadata||"",children:a.metadata?JSON.stringify(JSON.parse(a.metadata),null,0):"-"})]},a.id))})]})})]})}function Ze(){const[t,r]=i.useState("orgs");return e.jsx(oe,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-muted p-1 rounded-lg w-max",children:[e.jsxs(c,{variant:t==="orgs"?"default":"ghost",size:"sm",onClick:()=>r("orgs"),className:"gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),"Secretarias"]}),e.jsxs(c,{variant:t==="audit"?"default":"ghost",size:"sm",onClick:()=>r("audit"),className:"gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Auditoria"]})]}),e.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-2 duration-300",children:t==="orgs"?e.jsx(Fe,{}):e.jsx(Pe,{})})]})})}export{Ze as AdminDashboard};
