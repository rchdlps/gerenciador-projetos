import{j as e}from"./utils.BdS-FAhz.js";import{u as A,P as I}from"./providers.UQtKWlBt.js";import{r as o}from"./index.DIfZGIpv.js";import{u as w,b as _,c as x}from"./x.CzxnF3Yo.js";import{C as B,a as H,c as V,d as R,b as K,e as Q}from"./card.COi6a3zU.js";import{B as l}from"./button.C7nr6ow3.js";import{L as u,I as C}from"./label.CX8mjn5I.js";import{D as G,a as U,b as W,c as Z,d as J,e as X}from"./dialog.D-fiAzGC.js";import{T as Y}from"./textarea.IcwpziPU.js";import{S as k,b as S,c as P,d as F,e as p}from"./select.CmpBYXT0.js";import{P as ee}from"./plus.UANvjMxu.js";import{S as se}from"./search.Qw-1NHMa.js";import{c as m}from"./createLucideIcon.BT1YvhfI.js";import{B as ae}from"./building-2.DMSmHH9f.js";import"./index.XeJbqeyU.js";import"./index.DBb4ffa2.js";import"./index.nvHwJhPY.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],te=m("arrow-right",re);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],ie=m("folder",oe);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],le=m("funnel",ne);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M10 18v-7",key:"wt116b"}],["path",{d:"M11.12 2.198a2 2 0 0 1 1.76.006l7.866 3.847c.476.233.31.949-.22.949H3.474c-.53 0-.695-.716-.22-.949z",key:"1m329m"}],["path",{d:"M14 18v-7",key:"vav6t3"}],["path",{d:"M18 18v-7",key:"aexdmj"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M6 18v-7",key:"1ivflk"}]],de=m("landmark",ce);function me(){const L=A(),[O,c]=o.useState(!1),[j,g]=o.useState(""),[f,v]=o.useState(""),[i,N]=o.useState(""),[b,D]=o.useState(""),[d,z]=o.useState("all"),{data:t,isLoading:M}=w({queryKey:["organizations"],queryFn:async()=>{const s=await x.organizations.$get();if(!s.ok)throw new Error("Failed to fetch organizations");return s.json()}}),{data:q,isLoading:E}=w({queryKey:["projects"],queryFn:async()=>{const s=await x.projects.$get();if(!s.ok)throw new Error("Failed to fetch projects");return s.json()}});o.useEffect(()=>{t&&t.length>0&&!i&&N(t[0].id)},[t]);const h=_({mutationFn:async()=>{if(!i)throw new Error("Organization is required");const s=await x.projects.$post({json:{name:j,description:f,organizationId:i}});if(!s.ok)throw new Error("Failed to create");return s.json()},onSuccess:()=>{L.invalidateQueries({queryKey:["projects"]}),c(!1),g(""),v("")}}),T=s=>{if(!s)return"Projetos Pessoais / Legado";const a=t?.find(r=>r.id===s);return a?`${a.code} - ${a.name}`:"Outra Secretaria"},y=q?.filter(s=>{const a=b.toLowerCase(),r=s.name.toLowerCase().includes(a)||(s.description?.toLowerCase()||"").includes(a),$=d==="all"||d==="personal"&&!s.organizationId||s.organizationId===d;return r&&$}),n={};return y&&y.forEach(s=>{const a=s.organizationId||"personal";n[a]||(n[a]=[]),n[a].push(s)}),E||M?e.jsx("div",{className:"p-10 text-center text-muted-foreground animate-pulse",children:"Carregando dados..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 border-b pb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight text-foreground",children:"Projetos"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Gerencie e acompanhe seus projetos por Secretaria"})]}),e.jsxs(G,{open:O,onOpenChange:c,children:[e.jsx(U,{asChild:!0,children:e.jsxs(l,{className:"bg-primary hover:bg-primary/90 text-white shadow-lg shadow-primary/20 transition-all hover:scale-105 active:scale-95",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"})," Novo Projeto"]})}),e.jsxs(W,{className:"sm:max-w-md",children:[e.jsx(Z,{children:e.jsx(J,{children:"Criar Novo Projeto"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"org",children:"Secretaria / Unidade"}),e.jsxs(k,{value:i,onValueChange:N,children:[e.jsx(S,{id:"org",children:e.jsx(P,{placeholder:"Selecione a Secretaria"})}),e.jsx(F,{children:t?.map(s=>e.jsxs(p,{value:s.id,children:[s.code," - ",s.name]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"name",children:"Nome do Projeto"}),e.jsx(C,{id:"name",value:j,onChange:s=>g(s.target.value),placeholder:"ex: Implantação de ERP"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"desc",children:"Descrição"}),e.jsx(Y,{id:"desc",value:f,onChange:s=>v(s.target.value),placeholder:"Breve descrição do escopo..."})]})]}),e.jsxs(X,{children:[e.jsx(l,{variant:"outline",onClick:()=>c(!1),children:"Cancelar"}),e.jsx(l,{onClick:()=>h.mutate(),disabled:h.isPending||!i,children:h.isPending?"Criando...":"Criar Projeto"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 bg-muted/20 p-4 rounded-lg border",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(se,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(C,{placeholder:"Buscar projetos por nome ou descrição...",className:"pl-9 bg-background",value:b,onChange:s=>D(s.target.value)})]}),e.jsx("div",{className:"w-full sm:w-[300px]",children:e.jsxs(k,{value:d,onValueChange:z,children:[e.jsx(S,{className:"bg-background",children:e.jsxs("div",{className:"flex items-center gap-2 w-full overflow-hidden",children:[e.jsx(le,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsx("span",{className:"truncate",children:e.jsx(P,{placeholder:"Filtrar por Secretaria"})})]})}),e.jsxs(F,{children:[e.jsx(p,{value:"all",children:"Todas as Secretarias"}),t?.map(s=>e.jsxs(p,{value:s.id,children:[s.code," - ",s.name]},s.id))]})]})})]}),Object.keys(n).length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-24 text-center border-2 border-dashed rounded-xl bg-muted/30",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mb-4",children:e.jsx(ie,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Nenhum projeto encontrado"}),e.jsx("p",{className:"text-muted-foreground max-w-sm mb-6",children:"Você não possui projetos nesta secretaria ou ainda não criou nenhum."}),e.jsx(l,{onClick:()=>c(!0),children:"Criar Projeto"})]}):e.jsx("div",{className:"space-y-12",children:Object.entries(n).map(([s,a])=>e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex items-center gap-3 border-b-2 border-primary/10 pb-2",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(ae,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-foreground",children:T(s==="personal"?null:s)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.length," projetos ativos"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:a.map(r=>e.jsxs(B,{className:"group relative overflow-hidden transition-all hover:shadow-xl hover:-translate-y-1 border-border/50 bg-card h-full flex flex-col",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-primary opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs(H,{className:"pb-2 flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(V,{className:"text-lg font-bold group-hover:text-primary transition-colors line-clamp-2",children:r.name}),e.jsx(de,{className:"h-4 w-4 text-muted-foreground/50 flex-shrink-0 ml-2"})]}),e.jsx(R,{className:"line-clamp-3 text-sm mt-2",children:r.description})]}),e.jsx(K,{className:"pb-2 mt-auto",children:e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 inline-block"}),"Ativo",e.jsx("span",{className:"mx-2",children:"•"}),new Date(r.updatedAt).toLocaleDateString("pt-BR")]})}),e.jsx(Q,{className:"pt-4 border-t border-border/30 bg-muted/20",children:e.jsx(l,{asChild:!0,variant:"ghost",className:"w-full text-xs font-semibold group-hover:text-primary transition-colors justify-between px-0 hover:bg-transparent",children:e.jsxs("a",{href:`/projects/${r.id}`,children:["Acessar Projeto ",e.jsx(te,{className:"ml-2 h-3 w-3"})]})})})]},r.id))})]},s))})]})}function Le(){return e.jsx(I,{children:e.jsx(me,{})})}export{Le as DashboardWrapper};
