---
import DashboardLayout from "@/layouts/DashboardLayout.astro";
import { AdminNotificationsWrapper } from "@/components/admin/AdminNotificationsWrapper";
import { getPageContext } from "@/lib/queries/page-context";

const ctx = await getPageContext(Astro.request.headers);
if (!ctx) return Astro.redirect("/login");

// Admin guard: only super_admin or org secretario can access
if (!ctx.isSuperAdmin) {
  const isSecretario = ctx.orgSessionData?.organizations?.some(
    (o: any) => o.role === "secretario"
  );
  if (!isSecretario) {
    return Astro.redirect("/dashboard");
  }
}
---

<DashboardLayout
  title="Gerenciar Notificações"
  session={ctx.session}
  orgSessionData={ctx.orgSessionData}
>
  <AdminNotificationsWrapper client:load initialData={ctx.orgSessionData} />
</DashboardLayout>
