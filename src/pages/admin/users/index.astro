---
import DashboardLayout from "@/layouts/DashboardLayout.astro";
import { AdminUsersWrapper } from "@/components/admin/users/wrapper";
import { getPageContext } from "@/lib/queries/page-context";

const ctx = await getPageContext(Astro.request.headers);
if (!ctx) return Astro.redirect("/login");

// Admin guard: only super_admin or org secretario/gestor can manage users
if (!ctx.isSuperAdmin) {
  const canManageUsers = ctx.orgSessionData?.organizations?.some(
    (o: any) => o.role === "secretario" || o.role === "gestor",
  );
  if (!canManageUsers) {
    return Astro.redirect("/dashboard");
  }
}
---

<DashboardLayout
    title="Gerenciamento de UsuÃ¡rios"
    session={ctx.session}
    orgSessionData={ctx.orgSessionData}
>
    <AdminUsersWrapper client:only="react" />
</DashboardLayout>
